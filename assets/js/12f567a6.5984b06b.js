"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1232],{3905:function(n,e,t){t.d(e,{Zo:function(){return p},kt:function(){return s}});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function d(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var c=a.createContext({}),l=function(n){var e=a.useContext(c),t=e;return n&&(t="function"==typeof n?n(e):o(o({},e),n)),t},p=function(n){var e=l(n.components);return a.createElement(c.Provider,{value:e},n.children)},u={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,i=n.originalType,c=n.parentName,p=d(n,["components","mdxType","originalType","parentName"]),m=l(t),s=r,g=m["".concat(c,".").concat(s)]||m[s]||u[s]||i;return t?a.createElement(g,o(o({ref:e},p),{},{components:t})):a.createElement(g,o({ref:e},p))}));function s(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var i=t.length,o=new Array(i);o[0]=m;var d={};for(var c in e)hasOwnProperty.call(e,c)&&(d[c]=e[c]);d.originalType=n,d.mdxType="string"==typeof n?n:r,o[1]=d;for(var l=2;l<i;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6677:function(n,e,t){t.r(e),t.d(e,{contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return d},metadata:function(){return l},toc:function(){return p}});var a=t(7462),r=t(3366),i=(t(7294),t(3905)),o=["components"],d={title:"Crowd Fund",version:"0.8.10",description:"An example of crowd funding contract"},c=void 0,l={unversionedId:"solidity/example/app/CrowdFund",id:"solidity/example/app/CrowdFund",isDocsHomePage:!1,title:"Crowd Fund",description:"An example of crowd funding contract",source:"@site/docs/solidity/example/app/CrowdFund.md",sourceDirName:"solidity/example/app",slug:"/solidity/example/app/CrowdFund",permalink:"/rooctblog/docs/solidity/example/app/CrowdFund",tags:[],version:"current",frontMatter:{title:"Crowd Fund",version:"0.8.10",description:"An example of crowd funding contract"},sidebar:"docs",previous:{title:"Create2",permalink:"/rooctblog/docs/solidity/example/app/Create2"},next:{title:"Dutch Auction",permalink:"/rooctblog/docs/solidity/example/app/DutchAuction"}},p=[],u={toc:p};function m(n){var e=n.components,t=(0,r.Z)(n,o);return(0,i.kt)("wrapper",(0,a.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"\u7528\u6237\u521b\u5efa\u4f17\u7b79\u9879\u76ee")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4f17\u7b79\u9879\u76ee"),(0,i.kt)("li",{parentName:"ul"},"\u5728\u5f00\u59cb\u4e4b\u524d\u53ef\u4ee5\u53d6\u6d88\u4f17\u7b79\u6d3b\u52a8"),(0,i.kt)("li",{parentName:"ul"},"\u7528\u6237\u53c2\u4e0e\u4f17\u7b79\uff0c\u5fc5\u987b\u5728\u9879\u76ee\u5f00\u542f\u540e\uff0c\u7ed3\u675f\u524d\uff0c\u5e76\u4e14\u4f7f\u7528\u6307\u5b9a\u7684token\u53c2\u4e0e\u4f17\u7b79"),(0,i.kt)("li",{parentName:"ul"},"\u5728\u4f17\u7b79\u7ed3\u675f\u4e4b\u524d\uff0c\u7528\u6237\u53ef\u4ee5\u53d6\u6d88\u53c2\u4e0e\uff0c\u5982\u679c\u5df2\u7ecf\u7ed3\u675f\u4e86\u4e0d\u80fd\u53d6\u6d88\uff0c\u6263\u9664\u76f8\u5e94\u6570\u91cf\uff0c\u5e76\u8fd4\u56de\u8d39\u7528"),(0,i.kt)("li",{parentName:"ul"},"\u521b\u5efa\u8005\u9886\u53d6\u4f17\u7b79\u7684\u8d39\u7528\uff0c\u5fc5\u987b\u662f\u521b\u5efa\u8005\u624d\u80fd\u9886\u53d6\uff0c\u6d3b\u52a8\u5fc5\u987b\u7ed3\u675f\u540e\uff0c\u4e0d\u80fd\u91cd\u590d\u9886\u53d6\uff0c\u4f17\u7b79\u7684\u6570\u91cf\u5927\u4e8e\u7b49\u4e8e\u8bbe\u7f6e\u7684\u76ee\u6807\u6570\u91cf"),(0,i.kt)("li",{parentName:"ul"},"\u9879\u76ee\u4f17\u7b79\u65f6\u95f4\u7ed3\u675f\uff0c\u4f46\u6ca1\u6709\u8fbe\u5230\u4f17\u7b79\u76ee\u6807\uff0c\u7528\u6237\u64a4\u56de\u4f17\u7b79\u6b3e\uff0c\u6216\u8005\u81ea\u52a8\u64a4\u56de")),(0,i.kt)("p",null,"Crowd fund ERC20 token"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"User creates a campaign."),(0,i.kt)("li",{parentName:"ol"},"Users can pledge, transferring their token to a campaign."),(0,i.kt)("li",{parentName:"ol"},"After the campaign ends, campaign creator can claim the funds if total amount pledged is more than the campaign goal."),(0,i.kt)("li",{parentName:"ol"},"Otherwise, campaign did not reach it's goal, users can withdraw their pledge.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.10;\n\ninterface IERC20 {\n    function transfer(address, uint) external returns (bool);\n\n    function transferFrom(\n        address,\n        address,\n        uint\n    ) external returns (bool);\n}\n\ncontract CrowdFund {\n    event Launch(\n        uint id,\n        address indexed creator,\n        uint goal,\n        uint32 startAt,\n        uint32 endAt\n    );\n    event Cancel(uint id);\n    event Pledge(uint indexed id, address indexed caller, uint amount);\n    event Unpledge(uint indexed id, address indexed caller, uint amount);\n    event Claim(uint id);\n    event Refund(uint id, address indexed caller, uint amount);\n\n    struct Campaign {\n        // Creator of campaign\n        address creator;\n        // Amount of tokens to raise\n        uint goal;\n        // Total amount pledged\n        uint pledged;\n        // Timestamp of start of campaign\n        uint32 startAt;\n        // Timestamp of end of campaign\n        uint32 endAt;\n        // True if goal was reached and creator has claimed the tokens.\n        bool claimed;\n    }\n\n    IERC20 public immutable token;\n    // Total count of campaigns created.\n    // It is also used to generate id for new campaigns.\n    uint public count;\n    // Mapping from id to Campaign\n    mapping(uint => Campaign) public campaigns;\n    // Mapping from campaign id => pledger => amount pledged\n    mapping(uint => mapping(address => uint)) public pledgedAmount;\n\n    constructor(address _token) {\n        token = IERC20(_token);\n    }\n\n    function launch(\n        uint _goal,\n        uint32 _startAt,\n        uint32 _endAt\n    ) external {\n        require(_startAt >= block.timestamp, "start at < now");\n        require(_endAt >= _startAt, "end at < start at");\n        require(_endAt <= block.timestamp + 90 days, "end at > max duration");\n\n        count += 1;\n        campaigns[count] = Campaign({\n            creator: msg.sender,\n            goal: _goal,\n            pledged: 0,\n            startAt: _startAt,\n            endAt: _endAt,\n            claimed: false\n        });\n\n        emit Launch(count, msg.sender, _goal, _startAt, _endAt);\n    }\n\n    function cancel(uint _id) external {\n        Campaign memory campaign = campaigns[_id];\n        require(campaign.creator == msg.sender, "not creator");\n        require(block.timestamp < campaign.startAt, "started");\n\n        delete campaigns[_id];\n        emit Cancel(_id);\n    }\n\n    function pledge(uint _id, uint _amount) external {\n        Campaign storage campaign = campaigns[_id];\n        require(block.timestamp >= campaign.startAt, "not started");\n        require(block.timestamp <= campaign.endAt, "ended");\n\n        campaign.pledged += _amount;\n        pledgedAmount[_id][msg.sender] += _amount;\n        token.transferFrom(msg.sender, address(this), _amount);\n\n        emit Pledge(_id, msg.sender, _amount);\n    }\n\n    function unpledge(uint _id, uint _amount) external {\n        Campaign storage campaign = campaigns[_id];\n        require(block.timestamp <= campaign.endAt, "ended");\n\n        campaign.pledged -= _amount;\n        pledgedAmount[_id][msg.sender] -= _amount;\n        token.transfer(msg.sender, _amount);\n\n        emit Unpledge(_id, msg.sender, _amount);\n    }\n\n    function claim(uint _id) external {\n        Campaign storage campaign = campaigns[_id];\n        require(campaign.creator == msg.sender, "not creator");\n        require(block.timestamp > campaign.endAt, "not ended");\n        require(campaign.pledged >= campaign.goal, "pledged < goal");\n        require(!campaign.claimed, "claimed");\n\n        campaign.claimed = true;\n        token.transfer(campaign.creator, campaign.pledged);\n\n        emit Claim(_id);\n    }\n\n    function refund(uint _id) external {\n        Campaign memory campaign = campaigns[_id];\n        require(block.timestamp > campaign.endAt, "not ended");\n        require(campaign.pledged < campaign.goal, "pledged >= goal");\n\n        uint bal = pledgedAmount[_id][msg.sender];\n        pledgedAmount[_id][msg.sender] = 0;\n        token.transfer(msg.sender, bal);\n\n        emit Refund(_id, msg.sender, bal);\n    }\n}\n\n')))}m.isMDXComponent=!0}}]);