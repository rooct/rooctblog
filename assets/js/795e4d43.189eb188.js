"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1839],{3905:function(n,e,t){t.d(e,{Zo:function(){return m},kt:function(){return k}});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function p(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function o(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var u=a.createContext({}),s=function(n){var e=a.useContext(u),t=e;return n&&(t="function"==typeof n?n(e):p(p({},e),n)),t},m=function(n){var e=s(n.components);return a.createElement(u.Provider,{value:e},n.children)},l={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,i=n.originalType,u=n.parentName,m=o(n,["components","mdxType","originalType","parentName"]),d=s(t),k=r,N=d["".concat(u,".").concat(k)]||d[k]||l[k]||i;return t?a.createElement(N,p(p({ref:e},m),{},{components:t})):a.createElement(N,p({ref:e},m))}));function k(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var i=t.length,p=new Array(i);p[0]=d;var o={};for(var u in e)hasOwnProperty.call(e,u)&&(o[u]=e[u]);o.originalType=n,o.mdxType="string"==typeof n?n:r,p[1]=o;for(var s=2;s<i;s++)p[s]=t[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},9322:function(n,e,t){t.r(e),t.d(e,{contentTitle:function(){return u},default:function(){return d},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return m}});var a=t(7462),r=t(3366),i=(t(7294),t(3905)),p=["components"],o={},u="Uniswap-v2 Router\u5408\u7ea6\u5206\u6790",s={unversionedId:"dapps/DEX/Uniswap_v2/router_understand",id:"dapps/DEX/Uniswap_v2/router_understand",isDocsHomePage:!1,title:"Uniswap-v2 Router\u5408\u7ea6\u5206\u6790",description:"Router \u5408\u7ea6\u662f\u7528\u6237\u4f7f\u7528 Uniswap-v2 \u8fdb\u884c\u4ea4\u6362\u76f4\u63a5\u8c03\u7528\u7684\u5408\u7ea6\uff0c\u901a\u8fc7\u5206\u6790\u5b83\u53ef\u4ee5\u6df1\u5165\u4e86\u89e3 Uniswap-v2 \u7684\u4f7f\u7528\u903b\u8f91\u3002",source:"@site/docs/dapps/DEX/Uniswap_v2/router_understand.md",sourceDirName:"dapps/DEX/Uniswap_v2",slug:"/dapps/DEX/Uniswap_v2/router_understand",permalink:"/rooctblog/docs/dapps/DEX/Uniswap_v2/router_understand",tags:[],version:"current",frontMatter:{},sidebar:"dapp",previous:{title:"\u5feb\u901f\u4e86\u89e3 Uniswap-v2",permalink:"/rooctblog/docs/dapps/DEX/Uniswap_v2/quick_understand"},next:{title:"Uniswap-v2\u767d\u76ae\u4e66",permalink:"/rooctblog/docs/dapps/DEX/Uniswap_v2/whitepaper"}},m=[{value:"\u589e\u52a0\u6d41\u52a8\u6027",id:"\u589e\u52a0\u6d41\u52a8\u6027",children:[]},{value:"\u79fb\u9664\u6d41\u52a8\u6027",id:"\u79fb\u9664\u6d41\u52a8\u6027",children:[]},{value:"\u79fb\u9664\u6d41\u52a8\u6027\uff08\u652f\u6301\u4ee3\u4ed8GAS\u4ee3\u5e01\uff09",id:"\u79fb\u9664\u6d41\u52a8\u6027\u652f\u6301\u4ee3\u4ed8gas\u4ee3\u5e01",children:[]},{value:"\u4ea4\u6613",id:"\u4ea4\u6613",children:[]},{value:"\u4ea4\u6613\uff08\u652f\u6301\u4ee3\u4ed8GAS\u4ee3\u5e01\uff09",id:"\u4ea4\u6613\u652f\u6301\u4ee3\u4ed8gas\u4ee3\u5e01",children:[]}],l={toc:m};function d(n){var e=n.components,t=(0,r.Z)(n,p);return(0,i.kt)("wrapper",(0,a.Z)({},l,t,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"uniswap-v2-router\u5408\u7ea6\u5206\u6790"},"Uniswap-v2 Router\u5408\u7ea6\u5206\u6790"),(0,i.kt)("p",null,"Router \u5408\u7ea6\u662f\u7528\u6237\u4f7f\u7528 Uniswap-v2 \u8fdb\u884c\u4ea4\u6362\u76f4\u63a5\u8c03\u7528\u7684\u5408\u7ea6\uff0c\u901a\u8fc7\u5206\u6790\u5b83\u53ef\u4ee5\u6df1\u5165\u4e86\u89e3 Uniswap-v2 \u7684\u4f7f\u7528\u903b\u8f91\u3002"),(0,i.kt)("p",null,"\u6f14\u793a\u4ee3\u7801\u4ed3\u5e93\uff1a",(0,i.kt)("a",{parentName:"p",href:"https://github.com/33357/uniswap-v2-contract"},"https://github.com/33357/uniswap-v2-contract"),"\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662fRouter02\u3002"),(0,i.kt)("h2",{id:"\u589e\u52a0\u6d41\u52a8\u6027"},"\u589e\u52a0\u6d41\u52a8\u6027"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5185\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5185\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"_addLiquidity"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _addLiquidity(\n    address tokenA,\n    address tokenB,\n    uint amountADesired,\n    uint amountBDesired,\n    uint amountAMin,\n    uint amountBMin\n) internal virtual returns (uint amountA, uint amountB) {\n    if (IUniswapV2Factory(factory).getPair(tokenA, tokenB) == address(0)) {\n        IUniswapV2Factory(factory).createPair(tokenA, tokenB);\n    }\n    (uint reserveA, uint reserveB) = UniswapV2Library.getReserves(factory, tokenA, tokenB);\n    if (reserveA == 0 && reserveB == 0) {\n        (amountA, amountB) = (amountADesired, amountBDesired);\n    } else {\n        uint amountBOptimal = UniswapV2Library.quote(amountADesired, reserveA, reserveB);\n        if (amountBOptimal <= amountBDesired) {\n            require(amountBOptimal >= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n            (amountA, amountB) = (amountADesired, amountBOptimal);\n        } else {\n            uint amountAOptimal = UniswapV2Library.quote(amountBDesired, reserveB, reserveA);\n            assert(amountAOptimal <= amountADesired);\n            require(amountAOptimal >= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n            (amountA, amountB) = (amountAOptimal, amountBDesired);\n        }\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_addLiquidity")," \u7684\u5165\u53c2\u67096\u4e2a\uff0c\u51fa\u53c2\u67092\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _addLiquidity(\n    address tokenA, // \u6dfb\u52a0\u6d41\u52a8\u6027 tokenA \u7684\u5730\u5740\n    address tokenB, // \u6dfb\u52a0\u6d41\u52a8\u6027 tokenB \u7684\u5730\u5740\n    uint amountADesired, // \u671f\u671b\u6dfb\u52a0 tokenA \u7684\u6570\u91cf\n    uint amountBDesired, // \u671f\u671b\u6dfb\u52a0 tokenB \u7684\u6570\u91cf\n    uint amountAMin, // \u6dfb\u52a0 tokenA \u7684\u6700\u5c0f\u6570\u91cf\n    uint amountBMin // \u6dfb\u52a0 tokenB \u7684\u6700\u5c0f\u6570\u91cf\n) internal virtual returns (\n    uint amountA, // \u5b9e\u9645\u6dfb\u52a0 tokenA \u7684\u6570\u91cf\n    uint amountB // \u5b9e\u9645\u6dfb\u52a0 tokenB \u7684\u6570\u91cf\n    ) {\n        ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenA")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenB")," \u5f88\u597d\u7406\u89e3\uff0c\u4f46\u662f\u4e3a\u4ec0\u4e48\u8981\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountADesired"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"amountADesired"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"amountAMin"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"amountBMin")," \u5462\uff1f\u5b9e\u9645\u4e0a\u56e0\u4e3a\u7528\u6237\u5728\u533a\u5757\u94fe\u4e0a\u6dfb\u52a0\u6d41\u52a8\u6027\u5e76\u4e0d\u662f\u5b9e\u65f6\u5b8c\u6210\u7684\uff0c\u56e0\u6b64\u4f1a\u56e0\u4e3a\u5176\u4ed6\u7528\u6237\u7684\u64cd\u4f5c\u4ea7\u751f\u6570\u636e\u504f\u5dee\uff0c\u56e0\u6b64\u9700\u8981\u5728\u8fd9\u91cc\u6307\u5b9a\u4e00\u4e2a\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenA")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenB")," \u6dfb\u52a0\u6d41\u52a8\u6027\u7684\u6570\u503c\u8303\u56f4\u3002\u5728\u6dfb\u52a0\u6d41\u52a8\u6027\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148\u4f1a\u6839\u636e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountADesired")," \u8ba1\u7b97\u51fa\u5b9e\u9645\u8981\u6dfb\u52a0\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountB"),"\uff0c\u5982\u679c ",(0,i.kt)("inlineCode",{parentName:"p"},"amountB")," \u5927\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountBDesired")," \u5c31\u6362\u6210\u6839\u636e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountBDesired")," \u8ba1\u7b97\u51fa\u5b9e\u9645\u8981\u6dfb\u52a0\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountA"),"\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"...\n{\n    // \u5982\u679c tokenA,tokenB \u7684\u6d41\u52a8\u6c60\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u6d41\u52a8\u6c60\n    if (IUniswapV2Factory(factory).getPair(tokenA, tokenB) == address(0)) {\n        IUniswapV2Factory(factory).createPair(tokenA, tokenB);\n    }\n    // \u83b7\u53d6 tokenA,tokenB \u7684\u76ee\u524d\u5e93\u5b58\u6570\u91cf\n    (uint reserveA, uint reserveB) = UniswapV2Library.getReserves(factory, tokenA, tokenB);\n    if (reserveA == 0 && reserveB == 0) {\n        // \u5982\u679c\u5e93\u5b58\u6570\u91cf\u4e3a0\uff0c\u4e5f\u5c31\u662f\u65b0\u5efa tokenA,tokenB \u7684\u6d41\u52a8\u6c60\uff0c\u90a3\u4e48\u5b9e\u9645\u6dfb\u52a0\u7684amountA, amountB \u5c31\u662f amountADesired \u548c amountBDesired\n        (amountA, amountB) = (amountADesired, amountBDesired);\n    } else {\n        // amountADesired*reserveB/reserveA\uff0c\u7b97\u51fa\u5b9e\u9645\u8981\u6dfb\u52a0\u7684 tokenB \u6570\u91cf amountBOptimal\n        uint amountBOptimal = UniswapV2Library.quote(amountADesired, reserveA, reserveB);\n        if (amountBOptimal <= amountBDesired) {\n            // \u5982\u679c amountBMin <= amountBOptimal <= amountBDesired\uff0camountA \u548c amountB \u5c31\u662f amountADesired \u548c amountBOptimal\n            require(amountBOptimal >= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n            (amountA, amountB) = (amountADesired, amountBOptimal);\n        } else {\n            // amountBDesired*reserveA/reserveB\uff0c\u7b97\u51fa\u5b9e\u9645\u8981\u6dfb\u52a0\u7684 tokenA \u6570\u91cf amountAOptimal\n            uint amountAOptimal = UniswapV2Library.quote(amountBDesired, reserveB, reserveA);\n            // \u5982\u679c amountAMin <= amountAOptimal <= amountADesired\uff0camountA \u548c amountB \u5c31\u662f amountAOptimal \u548c amountBDesired\n            assert(amountAOptimal <= amountADesired);\n            require(amountAOptimal >= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n            (amountA, amountB) = (amountAOptimal, amountBDesired);\n        }\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u5728\u5b9e\u9645\u4e0a\uff0c\u8ba1\u7b97\u51fa\u6765\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"mountA")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"mountB")," \u53ea\u9700\u8981\u6ee1\u8db3\u8fd9\u4e2a\u516c\u5f0f\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"(amountAMin = mountA && amountBMin <= mountB <= amountBDesired) || (amountAMin <= mountA <= amountADesired && mountB = amountBDesired)"),"\u3002")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5916\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5916\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"addLiquidity"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function addLiquidity(\n    address tokenA,\n    address tokenB,\n    uint amountADesired,\n    uint amountBDesired,\n    uint amountAMin,\n    uint amountBMin,\n    address to,\n    uint deadline\n) external virtual override ensure(deadline) returns (uint amountA, uint amountB, uint liquidity) {\n    (amountA, amountB) = _addLiquidity(tokenA, tokenB, amountADesired, amountBDesired, amountAMin, amountBMin);\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    TransferHelper.safeTransferFrom(tokenA, msg.sender, pair, amountA);\n    TransferHelper.safeTransferFrom(tokenB, msg.sender, pair, amountB);\n    liquidity = IUniswapV2Pair(pair).mint(to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidity")," \u7684\u5165\u53c2\u67098\u4e2a\uff0c\u51fa\u53c2\u67093\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function addLiquidity(\n    address tokenA, // \u6dfb\u52a0\u6d41\u52a8\u6027 tokenA \u7684\u5730\u5740\n    address tokenB, // \u6dfb\u52a0\u6d41\u52a8\u6027 tokenB \u7684\u5730\u5740\n    uint amountADesired, // \u671f\u671b\u6dfb\u52a0 tokenA \u7684\u6570\u91cf\n    uint amountBDesired, // \u671f\u671b\u6dfb\u52a0 tokenB \u7684\u6570\u91cf\n    uint amountAMin, // \u6dfb\u52a0 tokenA \u7684\u6700\u5c0f\u6570\u91cf\n    uint amountBMin // \u6dfb\u52a0 tokenB \u7684\u6700\u5c0f\u6570\u91cf\n    address to, // \u83b7\u5f97\u7684 LP \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) returns (\n    uint amountA, // \u5b9e\u9645\u6dfb\u52a0 tokenA \u7684\u6570\u91cf\n    uint amountB // \u5b9e\u9645\u6dfb\u52a0 tokenB \u7684\u6570\u91cf\n    uint liquidity // \u83b7\u5f97 LP \u7684\u6570\u91cf\n    ) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u76f8\u6bd4\u4e8e\u5185\u90e8\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_addLiquidity"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidity")," \u51fd\u6570\u7684\u5165\u53c2\u591a\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"to")," \u548c  ",(0,i.kt)("inlineCode",{parentName:"p"},"deadline"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"to")," \u53ef\u4ee5\u6307\u5b9a LP\uff08\u6d41\u52a8\u6027\u51ed\u8bc1\uff09\u53d1\u9001\u5230\u54ea\u4e2a\u5730\u5740\uff0c\u800c ",(0,i.kt)("inlineCode",{parentName:"p"},"deadline")," \u5219\u8bbe\u7f6e\u4ea4\u6613\u8fc7\u671f\u65f6\u95f4\u3002\u51fa\u53c2\u5219\u591a\u4e86\u4e00\u4e2a ",(0,i.kt)("inlineCode",{parentName:"p"},"liquidity"),"\uff0c\u6307 LP \u7684\u6570\u91cf\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline){\n    // \u8ba1\u7b97\u5b9e\u9645\u6dfb\u52a0\u7684 amountA, amountB\n    (amountA, amountB) = _addLiquidity(tokenA, tokenB, amountADesired, amountBDesired, amountAMin, amountBMin);\n    // \u83b7\u53d6 tokenA, tokenB \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    // \u7528\u6237\u5411\u6d41\u52a8\u6c60\u53d1\u9001\u6570\u91cf\u4e3a amountA \u7684 tokenA\uff0camountB \u7684 tokenB\n    TransferHelper.safeTransferFrom(tokenA, msg.sender, pair, amountA);\n    TransferHelper.safeTransferFrom(tokenB, msg.sender, pair, amountB);\n    // \u6d41\u52a8\u6c60\u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a liquidity \u7684 LP\n    liquidity = IUniswapV2Pair(pair).mint(to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u5916\u90e8\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidity")," \u5b9e\u73b0\u4e86\u7528\u6237\u6dfb\u52a0 ",(0,i.kt)("inlineCode",{parentName:"p"},"ERC20")," \u4ea4\u6613\u5bf9\u6d41\u52a8\u6027\u7684\u64cd\u4f5c\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u8bbe\u7f6e ",(0,i.kt)("inlineCode",{parentName:"p"},"to")," \u5b9e\u9645\u4e0a\u65b9\u4fbf\u4e86\u7b2c\u4e09\u65b9\u5408\u7ea6\u6dfb\u52a0\u6d41\u52a8\u6027\uff0c\u8fd9\u4e3a\u540e\u6765\u805a\u5408\u4ea4\u6613\u6240\u7684\u51fa\u73b0\uff0c\u57cb\u4e0b\u4e86\u4f0f\u7b14\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"addLiquidityETH"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function addLiquidityETH(\n    address token,\n    uint amountTokenDesired,\n    uint amountTokenMin,\n    uint amountETHMin,\n    address to,\n    uint deadline\n) external virtual override payable ensure(deadline) returns (uint amountToken, uint amountETH, uint liquidity) {\n    (amountToken, amountETH) = _addLiquidity(\n        token,\n        WETH,\n        amountTokenDesired,\n        msg.value,\n        amountTokenMin,\n        amountETHMin\n    );\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    TransferHelper.safeTransferFrom(token, msg.sender, pair, amountToken);\n    IWETH(WETH).deposit{value: amountETH}();\n    assert(IWETH(WETH).transfer(pair, amountETH));\n    liquidity = IUniswapV2Pair(pair).mint(to);\n    if (msg.value > amountETH) TransferHelper.safeTransferETH(msg.sender, msg.value - amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidityETH")," \u7684\u5165\u53c2\u67096\u4e2a\uff0c\u51fa\u53c2\u67093\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"}," function addLiquidityETH(\n    address token, // \u6dfb\u52a0\u6d41\u52a8\u6027 token \u7684\u5730\u5740\n    uint amountTokenDesired, // \u671f\u671b\u6dfb\u52a0 token \u7684\u6570\u91cf\n    uint amountTokenMin, // \u6dfb\u52a0 token \u7684\u6700\u5c0f\u6570\u91cf\n    uint amountETHMin, // \u6dfb\u52a0 ETH \u7684\u6700\u5c0f\u6570\u91cf\n    address to, // \u83b7\u5f97\u7684 LP \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override payable ensure(deadline) returns (\n    uint amountToken, // \u5b9e\u9645\u6dfb\u52a0 token \u7684\u6570\u91cf\n    uint amountETH, // \u5b9e\u9645\u6dfb\u52a0 ETH \u7684\u6570\u91cf\n    uint liquidity // \u83b7\u5f97 LP \u7684\u6570\u91cf\n) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u76f8\u6bd4\u4e8e",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidity"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"addLiquidityETH")," \u51fd\u6570\u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u4f7f\u7528\u4e86 ETH \u4f5c\u4e3a tokenB\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u6307\u5b9a tokenB \u7684\u5730\u5740\u548c\u671f\u671b\u6570\u91cf\uff0c\u56e0\u4e3a tokenB \u7684\u5730\u5740\u5c31\u662f WETH \u7684\u5730\u5740\uff0ctokenB \u7684\u671f\u671b\u6570\u91cf\u5c31\u662f\u7528\u6237\u53d1\u9001\u7684 ETH \u6570\u91cf\u3002\u4f46\u8fd9\u6837\u4e5f\u591a\u4e86\u5c06 ETH \u6362\u6210 WETH\uff0c\u5e76\u5411\u7528\u6237\u8fd4\u8fd8\u591a\u4f59 ETH \u7684\u64cd\u4f5c\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline){\n    // \u8ba1\u7b97\u5b9e\u9645\u6dfb\u52a0\u7684 amountToken, amountETH\n    (amountToken, amountETH) = _addLiquidity(\n        token,\n        WETH,\n        amountTokenDesired,\n        msg.value,\n        amountTokenMin,\n        amountETHMin\n    );\n    // \u83b7\u53d6 token, WETH \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    // \u5411\u7528\u6237\u5411\u6d41\u52a8\u6c60\u53d1\u9001\u6570\u91cf\u4e3a amountToken \u7684 token\n    TransferHelper.safeTransferFrom(token, msg.sender, pair, amountToken);\n    // Router\u5c06\u7528\u6237\u53d1\u9001\u7684 ETH \u7f6e\u6362\u6210 WETH\n    IWETH(WETH).deposit{value: amountETH}();\n    // Router\u5411\u6d41\u52a8\u6c60\u53d1\u9001\u6570\u91cf\u4e3a amountETH \u7684 WETH\n    assert(IWETH(WETH).transfer(pair, amountETH));\n    // \u6d41\u52a8\u6c60\u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a liquidity \u7684 LP\n    liquidity = IUniswapV2Pair(pair).mint(to);\n    // \u5982\u679c\u7528\u6237\u53d1\u9001\u7684 ETH > amountETH\uff0cRouter\u5c31\u5411\u7528\u6237\u8fd4\u8fd8\u591a\u4f59\u7684 ETH\n    if (msg.value > amountETH) TransferHelper.safeTransferETH(msg.sender, msg.value - amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u7531\u4e8e ETH \u672c\u8eab\u4e0d\u662f ERC20 \u6807\u51c6\u7684\u4ee3\u5e01\uff0c\u56e0\u6b64\u5728\u6d89\u53ca\u6dfb\u52a0 ETH \u6d41\u52a8\u6027\u7684\u64cd\u4f5c\u65f6\u8981\u628a\u5b83\u6362\u6210\u517c\u5bb9 ERC20 \u63a5\u53e3 WETH\u3002"))))))),(0,i.kt)("h2",{id:"\u79fb\u9664\u6d41\u52a8\u6027"},"\u79fb\u9664\u6d41\u52a8\u6027"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u516c\u5171\u51fd\u6570\uff08\u5408\u7ea6\u5185\u5916\u90e8\u90fd\u53ef\u4ee5\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidity"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidity(\n    address tokenA,\n    address tokenB,\n    uint liquidity,\n    uint amountAMin,\n    uint amountBMin,\n    address to,\n    uint deadline\n) public virtual override ensure(deadline) returns (uint amountA, uint amountB) {\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    IUniswapV2Pair(pair).transferFrom(msg.sender, pair, liquidity);\n    (uint amount0, uint amount1) = IUniswapV2Pair(pair).burn(to);\n    (address token0,) = UniswapV2Library.sortTokens(tokenA, tokenB);\n    (amountA, amountB) = tokenA == token0 ? (amount0, amount1) : (amount1, amount0);\n    require(amountA >= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n    require(amountB >= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidity"),"\u7684\u5165\u53c2\u67097\u4e2a\uff0c\u51fa\u53c2\u67092\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidity(\n    address tokenA, // \u79fb\u9664\u6d41\u52a8\u6027 tokenA \u7684\u5730\u5740\n    address tokenB, // \u79fb\u9664\u6d41\u52a8\u6027 tokenB \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountAMin, // \u83b7\u5f97 tokenA \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountBMin, // \u83b7\u5f97 tokenB \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 tokenA\u3001tokenB \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) public virtual override ensure(deadline) returns (\n    uint amountA, // \u5b9e\u9645\u83b7\u5f97 tokenA \u7684\u6570\u91cf\n    uint amountB // \u5b9e\u9645\u83b7\u5f97 tokenB \u7684\u6570\u91cf\n    ) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u7528\u6237\u5728\u79fb\u9664\u6d41\u52a8\u6027\u65f6\uff0c\u9700\u8981\u9500\u6bc1 LP \u6362\u56de ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenA")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"tokenB"),"\u3002\u7531\u4e8e\u64cd\u4f5c\u4e0d\u662f\u5b9e\u65f6\u7684\uff0c\u56e0\u6b64\u540c\u6837\u9700\u8981\u6307\u5b9a ",(0,i.kt)("inlineCode",{parentName:"p"},"amountAMin")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"amountBMin"),"\uff0c\u5982\u679c\u5b9e\u9645\u83b7\u5f97\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountA")," \u5c0f\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountAMin")," \u6216\u8005 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountB")," \u5c0f\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountBMin"),"\uff0c\u90a3\u4e48\u79fb\u9664\u6d41\u52a8\u6027\u7684\u64cd\u4f5c\u90fd\u4f1a\u5931\u8d25\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline) {\n    // \u83b7\u53d6 token, WETH \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    // \u7528\u6237\u5411\u6d41\u52a8\u6c60\u53d1\u9001\u6570\u91cf\u4e3a liquidity \u7684 LP\n    IUniswapV2Pair(pair).transferFrom(msg.sender, pair, liquidity);\n    // \u6d41\u52a8\u6c60\u9500\u6bc1 LP \u5e76\u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a amount0 \u7684 token0 \u548c amount1 \u7684 token1\n    (uint amount0, uint amount1) = IUniswapV2Pair(pair).burn(to);\n    // \u8ba1\u7b97\u51fa tokenA, tokenB \u4e2d\u8c01\u662f token0\n    (address token0,) = UniswapV2Library.sortTokens(tokenA, tokenB);\n    // \u5982\u679c\u5b9e\u9645\u83b7\u5f97\u7684 amountA < amountAMin \u6216\u8005 amountB < amountBMin\uff0c\u90a3\u4e48\u4ea4\u6613\u5931\u8d25\n    (amountA, amountB) = tokenA == token0 ? (amount0, amount1) : (amount1, amount0);\n    require(amountA >= amountAMin, 'UniswapV2Router: INSUFFICIENT_A_AMOUNT');\n    require(amountB >= amountBMin, 'UniswapV2Router: INSUFFICIENT_B_AMOUNT');\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u79fb\u9664\u6d41\u52a8\u6027\u5e76\u4e0d\u4f1a\u68c0\u67e5\u4f60\u662f\u5426\u662f\u6d41\u52a8\u6027\u7684\u6dfb\u52a0\u8005\uff0c\u53ea\u8981\u4f60\u62e5\u6709 LP\uff0c\u90a3\u4e48\u5c31\u62e5\u6709\u4e86\u6d41\u52a8\u6027\u7684\u6240\u6709\u6743\u3002\u56e0\u6b64\u4e00\u5b9a\u8981\u4fdd\u7ba1\u597d\u81ea\u5df1\u7684 LP\uff08\u672c\u4eba\u771f\u91d1\u767d\u94f6\u7684\u6559\u8bad\uff09\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidityETH"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETH(\n    address token,\n    uint liquidity,\n    uint amountTokenMin,\n    uint amountETHMin,\n    address to,\n    uint deadline\n) public virtual override ensure(deadline) returns (uint amountToken, uint amountETH) {\n    (amountToken, amountETH) = removeLiquidity(\n        token,\n        WETH,\n        liquidity,\n        amountTokenMin,\n        amountETHMin,\n        address(this),\n        deadline\n    );\n    TransferHelper.safeTransfer(token, to, amountToken);\n    IWETH(WETH).withdraw(amountETH);\n    TransferHelper.safeTransferETH(to, amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETH"),"\u7684\u5165\u53c2\u67096\u4e2a\uff0c\u51fa\u53c2\u67092\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETH(\n    address token, // \u79fb\u9664\u6d41\u52a8\u6027 token \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountTokenMin, // \u83b7\u5f97 token \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountETHMin, // \u83b7\u5f97 ETH \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 token\u3001ETH \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) public virtual override ensure(deadline) returns (\n    uint amountToken, // \u5b9e\u9645\u83b7\u5f97 token \u7684\u6570\u91cf\n    uint amountETH // \u5b9e\u9645\u83b7\u5f97 ETH \u7684\u6570\u91cf\n) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u56e0\u4e3a\u79fb\u9664\u6d41\u52a8\u6027\u7684\u662f ETH\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u4f20\u5165 ETH \u7684\u5730\u5740\uff0c\u6539\u4e3a\u4f7f\u7528 WETH\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline) {\n    // \u79fb\u9664\u6d41\u52a8\u6027\uff0cRouter\u83b7\u5f97\u6570\u91cf\u4e3a amountToken \u7684 token\uff0camountETH \u7684 WETH\n    (amountToken, amountETH) = removeLiquidity(\n        token,\n        WETH,\n        liquidity,\n        amountTokenMin,\n        amountETHMin,\n        address(this),\n        deadline\n    );\n    // \u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a amountToken \u7684 token\n    TransferHelper.safeTransfer(token, to, amountToken);\n    // \u5c06\u6570\u91cf\u4e3a amountETH \u7684 WETH \u6362\u6210 ETH\n    IWETH(WETH).withdraw(amountETH);\n    // \u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a amountToken \u7684 ETH\n    TransferHelper.safeTransferETH(to, amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u56e0\u4e3a\u6d41\u52a8\u6c60\u4e2d\u8d28\u62bc\u7684\u662f WETH\uff0c\u56e0\u6b64\u5728\u79fb\u9664\u6d41\u52a8\u6027\u65f6\u9700\u8981\u628a WETH \u6362\u56de ETH\u3002")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5916\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5916\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidityWithPermit"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityWithPermit(\n    address tokenA,\n    address tokenB,\n    uint liquidity,\n    uint amountAMin,\n    uint amountBMin,\n    address to,\n    uint deadline,\n    bool approveMax, uint8 v, bytes32 r, bytes32 s\n) external virtual override returns (uint amountA, uint amountB) {\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    uint value = approveMax ? uint(-1) : liquidity;\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n    (amountA, amountB) = removeLiquidity(tokenA, tokenB, liquidity, amountAMin, amountBMin, to, deadline);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityWithPermit")," \u7684\u5165\u53c2\u670911\u4e2a\uff0c\u51fa\u53c2\u67092\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityWithPermit(\n    address tokenA, // \u79fb\u9664\u6d41\u52a8\u6027 tokenA \u7684\u5730\u5740\n    address tokenB, // \u79fb\u9664\u6d41\u52a8\u6027 tokenB \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountAMin, // \u83b7\u5f97 tokenA \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountBMin, // \u83b7\u5f97 tokenB \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 tokenA\u3001tokenB \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline, // \u8fc7\u671f\u65f6\u95f4\n    bool approveMax, // \u662f\u5426\u6388\u6743\u4e3a\u6700\u5927\u503c\n    uint8 v, bytes32 r, bytes32 s // \u7b7e\u540d v,r,s\n) external virtual override returns (\n    uint amountA, // \u5b9e\u9645\u83b7\u5f97 tokenA \u7684\u6570\u91cf\n    uint amountB // \u5b9e\u9645\u83b7\u5f97 tokenB \u7684\u6570\u91cf\n    ) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityWithPermit")," \u8fd9\u4e2a\u5b9e\u73b0\u4e86\u7b7e\u540d\u6388\u6743 Router \u4f7f\u7528\u7528\u6237\u7684 LP\u3002\u9996\u5148\u8981\u660e\u786e\u7684\u662f\uff0c\u5408\u7ea6\u8c03\u7528\u7528\u6237\u7684\u4ee3\u5e01\u9700\u8981\u7528\u6237\u7684\u6388\u6743\u624d\u80fd\u8fdb\u884c\uff0c\u800c LP \u7684\u6388\u6743\u65e2\u53ef\u4ee5\u53d1\u9001\u4e00\u7b14\u4ea4\u6613\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u7b7e\u540d\u3002\u800c\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityWithPermit")," \u53ef\u4ee5\u8ba9\u7528\u6237\u514d\u4e8e\u53d1\u9001\u4e00\u7b14\u6388\u6743\u4ea4\u6613\uff0c\u8f6c\u800c\u4f7f\u7528\u7b7e\u540d\uff0c\u4ece\u800c\u7b80\u5316\u7528\u6237\u7684\u64cd\u4f5c\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n{\n    // \u83b7\u53d6 tokenA, tokenB \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, tokenA, tokenB);\n    // \u83b7\u53d6\u6388\u6743 LP \u7684\u6570\u91cf\n    uint value = approveMax ? uint(-1) : liquidity;\n    // \u6388\u6743 Router \u4f7f\u7528\u7528\u6237\u6570\u91cf\u4e3a value \u7684 LP\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n    // \u79fb\u9664\u6d41\u52a8\u6027\n    (amountA, amountB) = removeLiquidity(tokenA, tokenB, liquidity, amountAMin, amountBMin, to, deadline);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u4f7f\u7528\u7b7e\u540d\u8fdb\u884c\u6388\u6743\uff0c\u7b80\u5316\u4e86\u7528\u6237\u7684\u64cd\u4f5c\uff0c\u4f46\u6709\u4e9b\u4eba\u53ef\u80fd\u4f1a\u5229\u7528\u7528\u6237\u5bf9\u7b7e\u540d\u7684\u4e0d\u4e86\u89e3\uff0c\u76d7\u7a83\u7528\u6237\u8d44\u4ea7\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidityETHWithPermit"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETHWithPermit(\n    address token,\n    uint liquidity,\n    uint amountTokenMin,\n    uint amountETHMin,\n    address to,\n    uint deadline,\n    bool approveMax, uint8 v, bytes32 r, bytes32 s\n) external virtual override returns (uint amountToken, uint amountETH) {\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    uint value = approveMax ? uint(-1) : liquidity;\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n    (amountToken, amountETH) = removeLiquidityETH(token, liquidity, amountTokenMin, amountETHMin, to, deadline);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHWithPermit"),"\u7684\u5165\u53c2\u670910\u4e2a\uff0c\u51fa\u53c2\u67092\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"}," function removeLiquidityETHWithPermit(\n    address token, // \u79fb\u9664\u6d41\u52a8\u6027 token \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountTokenMin, // \u83b7\u5f97 token \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountETHMin, // \u83b7\u5f97 ETH \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 token\u3001ETH \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline, // \u8fc7\u671f\u65f6\u95f4\n    bool approveMax,  // \u662f\u5426\u6388\u6743\u4e3a\u6700\u5927\u503c\n    uint8 v, bytes32 r, bytes32 s // \u7b7e\u540d v,r,s\n) external virtual override returns (\n    uint amountToken, // \u5b9e\u9645\u83b7\u5f97 token \u7684\u6570\u91cf\n    uint amountETH // \u5b9e\u9645\u83b7\u5f97 ETH \u7684\u6570\u91cf\n    ){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u56e0\u4e3a\u79fb\u9664\u6d41\u52a8\u6027\u7684\u662f ETH\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u4f20\u5165 ETH \u7684\u5730\u5740\uff0c\u6539\u4e3a\u4f7f\u7528 WETH\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n{\n    // \u83b7\u53d6 tokenA, WETH \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    // \u83b7\u53d6\u6388\u6743 LP \u7684\u6570\u91cf\n    uint value = approveMax ? uint(-1) : liquidity;\n    // \u6388\u6743 Router \u4f7f\u7528\u7528\u6237\u6570\u91cf\u4e3a value \u7684 LP\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n     // \u79fb\u9664 ETH \u6d41\u52a8\u6027\n    (amountToken, amountETH) = removeLiquidityETH(token, liquidity, amountTokenMin, amountETHMin, to, deadline);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u65e0"))))))),(0,i.kt)("h2",{id:"\u79fb\u9664\u6d41\u52a8\u6027\u652f\u6301\u4ee3\u4ed8gas\u4ee3\u5e01"},"\u79fb\u9664\u6d41\u52a8\u6027\uff08\u652f\u6301\u4ee3\u4ed8GAS\u4ee3\u5e01\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u516c\u5171\u51fd\u6570\uff08\u5408\u7ea6\u5185\u5916\u90e8\u90fd\u53ef\u4ee5\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidityETHSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETHSupportingFeeOnTransferTokens(\n    address token,\n    uint liquidity,\n    uint amountTokenMin,\n    uint amountETHMin,\n    address to,\n    uint deadline\n) public virtual override ensure(deadline) returns (uint amountETH) {\n    (, amountETH) = removeLiquidity(\n        token,\n        WETH,\n        liquidity,\n        amountTokenMin,\n        amountETHMin,\n        address(this),\n        deadline\n    );\n    TransferHelper.safeTransfer(token, to, IERC20(token).balanceOf(address(this)));\n    IWETH(WETH).withdraw(amountETH);\n    TransferHelper.safeTransferETH(to, amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHSupportingFeeOnTransferTokens"),"\u7684\u5165\u53c2\u67096\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETHSupportingFeeOnTransferTokens(\n    address token, // \u79fb\u9664\u6d41\u52a8\u6027 token \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountTokenMin, // \u83b7\u5f97 token \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountETHMin, // \u83b7\u5f97 ETH \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 token\u3001ETH \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) public virtual override ensure(deadline) returns (\n    uint amountETH // \u5b9e\u9645\u83b7\u5f97 ETH \u7684\u6570\u91cf\n) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u4ece\u53c2\u6570\u4e0a\u770b\uff0c\u76f8\u6bd4\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETH"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHSupportingFeeOnTransferTokens")," \u5c11\u4e86\u4e00\u4e2a\u51fa\u53c2\u3002\u8fd9\u662f\u56e0\u4e3a\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHSupportingFeeOnTransferTokens")," \u7684\u4e3b\u8981\u529f\u80fd\u662f\u652f\u6301\u7b2c\u4e09\u65b9\u4e3a\u7528\u6237\u652f\u4ed8\u624b\u7eed\u8d39\u5e76\u6536\u53d6\u4e00\u5b9a\u7684\u4ee3\u5e01\uff0c\u56e0\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountToken")," \u4e2d\u6709\u4e00\u90e8\u5206\u4f1a\u88ab\u7b2c\u4e09\u65b9\u6536\u53d6\uff0c\u7528\u6237\u771f\u5b9e\u83b7\u53d6\u7684\u4ee3\u5e01\u6570\u91cf\u4f1a\u6bd4 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountToken")," \u5c11\u3002\u5177\u4f53\u89c1 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ethereum/EIPs/issues/865"},"ERC865"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n// \u79fb\u9664\u6d41\u52a8\u6027\uff0cRouter\u83b7\u5f97\u4e0d\u5b9a\u6570\u91cf\u7684 token\uff0c\u6570\u91cf\u4e3a amountETH \u7684 WETH\n    (, amountETH) = removeLiquidity(\n        token,\n        WETH,\n        liquidity,\n        amountTokenMin,\n        amountETHMin,\n        address(this),\n        deadline\n    );\n    // \u5411 to \u5730\u5740\u53d1\u9001\u5168\u90e8 token\n    TransferHelper.safeTransfer(token, to, IERC20(token).balanceOf(address(this)));\n    // \u5c06\u6570\u91cf\u4e3a amountETH \u7684 WETH \u6362\u6210 ETH\n    IWETH(WETH).withdraw(amountETH);\n    // \u5411 to \u5730\u5740\u53d1\u9001\u6570\u91cf\u4e3a amountToken \u7684 ETH\n    TransferHelper.safeTransferETH(to, amountETH);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u5b9e\u9645\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHSupportingFeeOnTransferTokens")," \u652f\u6301\u4e86\u6240\u6709\u5728\u79fb\u9664\u6d41\u52a8\u6027\u65f6\uff0c\u6570\u91cf\u4f1a\u53d8\u5316\u7684\u4ee3\u5e01\uff0c\u6709\u4e00\u4e9b\u4ee3\u5e01\u7684\u7ecf\u6d4e\u6a21\u5f0f\u5229\u7528\u5230\u4e86\u8fd9\u70b9\u3002")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5916\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5916\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"removeLiquidityETHWithPermitSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(\n    address token,\n    uint liquidity,\n    uint amountTokenMin,\n    uint amountETHMin,\n    address to,\n    uint deadline,\n    bool approveMax, uint8 v, bytes32 r, bytes32 s\n) external virtual override returns (uint amountETH) {\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    uint value = approveMax ? uint(-1) : liquidity;\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n    amountETH = removeLiquidityETHSupportingFeeOnTransferTokens(\n        token, liquidity, amountTokenMin, amountETHMin, to, deadline\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHWithPermitSupportingFeeOnTransferTokens"),"\u7684\u5165\u53c2\u670910\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function removeLiquidityETHWithPermitSupportingFeeOnTransferTokens(\n    address token, // \u79fb\u9664\u6d41\u52a8\u6027 token \u7684\u5730\u5740\n    uint liquidity, // \u9500\u6bc1 LP \u7684\u6570\u91cf\n    uint amountTokenMin,  // \u83b7\u5f97 token \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    uint amountETHMin,  // \u83b7\u5f97 ETH \u6570\u91cf\u7684\u6700\u5c0f\u503c\n    address to, // \u83b7\u5f97\u7684 token\u3001ETH \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline, // \u8fc7\u671f\u65f6\u95f4\n    bool approveMax, // \u662f\u5426\u6388\u6743\u4e3a\u6700\u5927\u503c\n    uint8 v, bytes32 r, bytes32 s // \u7b7e\u540d v,r,s\n) external virtual override returns (\n    uint amountETH // \u5b9e\u9645\u83b7\u5f97 ETH \u7684\u6570\u91cf\n) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHWithPermitSupportingFeeOnTransferTokens"),"\u540c\u6837\u6bd4 ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityETHWithPermit")," \u5c11\u4e86\u4e00\u4e2a\u51fa\u53c2\uff0c\u8fd9\u540c\u6837\u662f\u4e3a\u4e86\u652f\u6301\u5728\u79fb\u9664\u6d41\u52a8\u6027\u65f6\uff0c\u6570\u91cf\u4f1a\u53d8\u5316\u7684\u4ee3\u5e01\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n{\n    // \u83b7\u53d6 tokenA, WETH \u7684\u6d41\u52a8\u6c60\u5730\u5740\n    address pair = UniswapV2Library.pairFor(factory, token, WETH);\n    // \u83b7\u53d6\u6388\u6743 LP \u7684\u6570\u91cf\n    uint value = approveMax ? uint(-1) : liquidity;\n    // \u6388\u6743 Router \u4f7f\u7528\u7528\u6237\u6570\u91cf\u4e3a value \u7684 LP\n    IUniswapV2Pair(pair).permit(msg.sender, address(this), value, deadline, v, r, s);\n    // \u79fb\u9664\u6d41\u52a8\u6027\u5e76\u83b7\u5f97\u4e0d\u5b9a\u6570\u91cf\u7684 token \u548c\u6570\u91cf\u4e3a amountETH \u7684 ETH\n    amountETH = removeLiquidityETHSupportingFeeOnTransferTokens(\n        token, liquidity, amountTokenMin, amountETHMin, to, deadline\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u65e0"))))))),(0,i.kt)("h2",{id:"\u4ea4\u6613"},"\u4ea4\u6613"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5185\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5185\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"_swap"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _swap(uint[] memory amounts, address[] memory path, address _to) internal virtual {\n    for (uint i; i < path.length - 1; i++) {\n        (address input, address output) = (path[i], path[i + 1]);\n        (address token0,) = UniswapV2Library.sortTokens(input, output);\n        uint amountOut = amounts[i + 1];\n        (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOut) : (amountOut, uint(0));\n        address to = i < path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n        IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output)).swap(\n            amount0Out, amount1Out, to, new bytes(0)\n        );\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_swap")," \u7684\u5165\u53c2\u67093\u4e2a\uff0c\u51fa\u53c2\u67090\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _swap(\n    uint[] memory amounts, // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n    address[] memory path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address _to // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n) internal virtual {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_swap")," \u5b9e\u73b0\u4e86\u7531\u591a\u91cd\u4ea4\u6613\u7ec4\u6210\u7684\u4ea4\u6613\u96c6\u5408\u3002",(0,i.kt)("inlineCode",{parentName:"p"},"path")," \u6570\u7ec4\u91cc\u5b9a\u4e49\u4e86\u6267\u884c\u4ee3\u5e01\u4ea4\u6613\u7684\u987a\u5e8f\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"amounts")," \u6570\u7ec4\u91cc\u5b9a\u4e49\u4e86\u6bcf\u6b21\u4ea4\u6362\u83b7\u5f97\u4ee3\u5e01\u7684\u671f\u671b\u6570\u91cf\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"_to")," \u5219\u662f\u6700\u540e\u83b7\u5f97\u4ee3\u5e01\u53d1\u9001\u5230\u7684\u5730\u5740\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"...\n{\n    // \u5faa\u73af\u4ea4\u6613\u8def\u5f84\u5217\u8868\n    for (uint i; i < path.length - 1; i++) {\n        // \u4ece path \u4e2d\u53d6\u51fa input \u548c output\n        (address input, address output) = (path[i], path[i + 1]);\n        // \u4ece input \u548c output \u4e2d\u7b97\u51fa\u8c01\u662f token0\n        (address token0,) = UniswapV2Library.sortTokens(input, output);\n        // \u671f\u671b\u4ea4\u6613\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\n        uint amountOut = amounts[i + 1];\n        // \u5982\u679c input == token0\uff0c\u90a3\u4e48 amount0Out \u5c31\u662f0\uff0camount1Out \u5c31\u662f amountOut\uff1b\u53cd\u4e4b\u5219\u76f8\u53cd\n        (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOut) : (amountOut, uint(0));\n        // \u5982\u679c\u8fd9\u662f\u6700\u540e\u7684\u4e00\u7b14\u4ea4\u6613\uff0c\u90a3\u4e48 to \u5730\u5740\u5c31\u662f _to\uff0c\u5426\u5219 to \u5730\u5740\u662f\u4e0b\u4e00\u7b14\u4ea4\u6613\u7684\u6d41\u52a8\u6c60\u5730\u5740\n        address to = i < path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n        // \u6267\u884c input \u548c output \u7684\u4ea4\u6613\n        IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output)).swap(\n            amount0Out, amount1Out, to, new bytes(0)\n        );\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u7531\u4e8e\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"swap")," \u65f6\uff0c\u9700\u8981\u6392\u5217 ",(0,i.kt)("inlineCode",{parentName:"p"},"amount0Out"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"amount1Out")," \u7684\u987a\u5e8f\uff0c\u56e0\u6b64\u9700\u8981\u8ba1\u7b97 ",(0,i.kt)("inlineCode",{parentName:"p"},"input"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"output")," \u4e2d\u8c01\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"token0"),"\u3002")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5916\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5916\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactTokensForTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForTokens(\n    uint amountIn,\n    uint amountOutMin,\n    address[] calldata path,\n    address to,\n    uint deadline\n) external virtual override ensure(deadline) returns (uint[] memory amounts) {\n    amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForTokens(\n    uint amountIn,// \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u6570\u91cf\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens")," \u5b9e\u73b0\u4e86\u7528\u6237\u4f7f\u7528\u6570\u91cf\u7cbe\u786e\u7684 tokenA \u4ea4\u6613\u6570\u91cf\u4e0d\u7cbe\u786e\u7684 tokenB \u7684\u6d41\u7a0b\u3002\u7528\u6237\u4f7f\u7528\u786e\u5b9a\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountIn")," \u6570\u91cf\u7684 tokenA \uff0c\u4ea4\u6613\u83b7\u5f97 tokenB \u7684\u6570\u91cf\u4e0d\u4f1a\u5c0f\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountOutMin"),"\uff0c\u4f46\u5177\u4f53 tokenB \u7684\u6570\u91cf\u53ea\u6709\u4ea4\u6613\u5b8c\u6210\u4e4b\u540e\u624d\u80fd\u77e5\u9053\u3002\u8fd9\u540c\u6837\u662f\u7531\u4e8e\u533a\u5757\u94fe\u4e0a\u4ea4\u6613\u4e0d\u662f\u5b9e\u65f6\u7684\uff0c\u5b9e\u9645\u4ea4\u6613\u548c\u9884\u671f\u4ea4\u6613\u76f8\u6bd4\u4f1a\u6709\u4e00\u5b9a\u7684\u504f\u79fb\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u652f\u4ed8 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n    // \u5982\u679c\u6700\u7ec8\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u5219\u4ea4\u6613\u5931\u8d25\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u53ef\u4ee5\u770b\u5230\uff0c\u7531\u4e8e\u533a\u5757\u94fe\u4e0a\u7684\u5b9e\u9645\u4ea4\u6613\u548c\u9884\u671f\u4ea4\u6613\u6709\u504f\u5dee\u662f\u5e38\u89c1\u7684\u4e8b\u60c5\uff0c\u56e0\u6b64\u5728\u8bbe\u8ba1\u94fe\u4e0a\u4ea4\u6613\u7684\u65f6\u5019\u903b\u8f91\u4f1a\u6bd4\u8f83\u590d\u6742\uff0c\u6761\u4ef6\u9009\u62e9\u4f1a\u6709\u5f88\u591a\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapTokensForExactTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapTokensForExactTokens(\n    uint amountOut,\n    uint amountInMax,\n    address[] calldata path,\n    address to,\n    uint deadline\n) external virtual override ensure(deadline) returns (uint[] memory amounts) {\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    require(amounts[0] <= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactTokens"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapTokensForExactTokens(\n    uint amountOut, // \u4ea4\u6613\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\n    uint amountInMax, // \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u7684\u6700\u591a\u6570\u91cf\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n    ){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactTokens")," \u5b9e\u73b0\u4e86\u7528\u6237\u4f7f\u7528\u6570\u91cf\u4e0d\u7cbe\u786e\u7684 tokenA \u4ea4\u6613\u6570\u91cf\u7cbe\u786e\u7684 tokenB \u7684\u6d41\u7a0b\u3002\u7528\u6237\u4f1a\u4f7f\u7528\u6570\u91cf\u4e0d\u5927\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"amountInMax")," \u6570\u91cf\u7684 tokenA\uff0c\u4ea4\u6613\u83b7\u5f97 ",(0,i.kt)("inlineCode",{parentName:"p"},"amountOut")," \u6570\u91cf\u7684 tokenB\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u83b7\u5f97 amountIn \u6570\u91cf\u7684 path[path.length-1] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    // \u5982\u679c path[0] \u4ee3\u5e01\u6570\u91cf\u5927\u4e8e amountInMax\uff0c\u5219\u4ea4\u6613\u5931\u8d25\n    require(amounts[0] <= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactTokens")," \u5b8c\u5168\u662f\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens")," \u7684\u76f8\u53cd\u64cd\u4f5c\u3002\u4e00\u822c\u6765\u8bf4\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens")," \u7528\u4e8e\u51fa\u552e\u786e\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactTokens")," \u7528\u4e8e\u8d2d\u4e70\u786e\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactETHForTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactETHForTokens(uint amountOutMin, address[] calldata path, address to, uint deadline)\n    external\n    virtual\n    override\n    payable\n    ensure(deadline)\n    returns (uint[] memory amounts)\n{\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    amounts = UniswapV2Library.getAmountsOut(factory, msg.value, path);\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    IWETH(WETH).deposit{value: amounts[0]}();\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokens"),"\u7684\u5165\u53c2\u67094\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactETHForTokens(\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override payable ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokens")," \u548c\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens")," \u7684\u903b\u8f91\u51e0\u4e4e\u4e00\u6837\uff0c\u53ea\u662f\u628a\u652f\u4ed8\u7cbe\u786e\u6570\u91cf\u7684 token \u6362\u6210\u4e86\u652f\u4ed8\u7cbe\u786e\u6570\u91cf\u7684 ETH\u3002\u56e0\u6b64\u591a\u4e86\u4e00\u4e9b\u548c ETH \u76f8\u5173\u7684\u989d\u5916\u64cd\u4f5c\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u68c0\u67e5 path[0] \u662f\u5426\u4e3a WETH \u5730\u5740\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u652f\u4ed8 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsOut(factory, msg.value, path);\n    // \u5982\u679c\u6700\u7ec8\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u5219\u4ea4\u6613\u5931\u8d25\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    // \u628a\u7528\u6237\u652f\u4ed8\u7684 ETH \u6362\u6210 WETH\n    IWETH(WETH).deposit{value: amounts[0]}();\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 WETH \u4ee3\u5e01\u4ece Router \u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, to);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u51fa\u552e\u786e\u5b9a\u6570\u91cf\u7684 ETH\uff0c\u83b7\u5f97\u4e0d\u786e\u5b9a\u6570\u91cf\u4ee3\u5e01\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapTokensForExactETH"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapTokensForExactETH(uint amountOut, uint amountInMax, address[] calldata path, address to, uint deadline)\n    external\n    virtual\n    override\n    ensure(deadline)\n    returns (uint[] memory amounts)\n{\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    require(amounts[0] <= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    _swap(amounts, path, address(this));\n    IWETH(WETH).withdraw(amounts[amounts.length - 1]);\n    TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactETH")," \u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapTokensForExactETH(\n    uint amountOut, // \u4ea4\u6613\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\n    uint amountInMax, // \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u7684\u6700\u591a\u6570\u91cf\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n)external virtual override ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactETH")," \u548c \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokens")," \u76f8\u6bd4\uff0c\u4ec5\u4ea4\u6362\u4e86\u4e00\u4e0b\u4ee3\u5e01\u7684\u4ea4\u6613\u987a\u5e8f\uff0c\u6267\u884c\u903b\u8f91\u8fd8\u662f\u5dee\u4e0d\u591a\u7684\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u68c0\u67e5 path[path.length - 1] \u662f\u5426\u4e3a WETH \u5730\u5740\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u83b7\u5f97 amountOut \u6570\u91cf\u7684 path[path.length-1] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    // \u5982\u679c\u6700\u7ec8\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u5219\u4ea4\u6613\u5931\u8d25\n    require(amounts[0] <= amountInMax, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, address(this));\n    // \u5c06 WETH \u6362\u6210 ETH\n    IWETH(WETH).withdraw(amounts[amounts.length - 1]);  \n    // \u628a ETH \u53d1\u9001\u7ed9 to \u5730\u5740\n    TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u8d2d\u4e70\u786e\u5b9a\u6570\u91cf\u7684 ETH\uff0c\u7528\u4e0d\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\u4ea4\u6362\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactTokensForETH"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForETH(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)\n    external\n    virtual\n    override\n    ensure(deadline)\n    returns (uint[] memory amounts)\n{\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    _swap(amounts, path, address(this));\n    IWETH(WETH).withdraw(amounts[amounts.length - 1]);\n    TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETH"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForETH(\n    uint amountIn,// \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u6570\u91cf\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETH")," \u548c \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapTokensForExactETH")," \u76f8\u6bd4\uff0c\u662f\u66f4\u6362\u4e86\u8f93\u5165\u7cbe\u786e\u6570\u91cf\u4ee3\u5e01\u7684\u987a\u5e8f\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u68c0\u67e5 path[path.length - 1] \u662f\u5426\u4e3a WETH \u5730\u5740\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u652f\u4ed8 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);\n    // \u5982\u679c\u6700\u7ec8\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u5219\u4ea4\u6613\u5931\u8d25\n    require(amounts[amounts.length - 1] >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]\n    );\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, address(this));\n    // \u5c06 WETH \u6362\u6210 ETH\n    IWETH(WETH).withdraw(amounts[amounts.length - 1]);\n    // \u628a ETH \u53d1\u9001\u7ed9 to \u5730\u5740\n    TransferHelper.safeTransferETH(to, amounts[amounts.length - 1]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u51fa\u552e\u786e\u5b9a\u6570\u91cf\u4ee3\u5e01\uff0c\u83b7\u5f97\u4e0d\u786e\u5b9a\u6570\u91cf\u7684 ETH\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapETHForExactTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapETHForExactTokens(uint amountOut, address[] calldata path, address to, uint deadline)\n    external\n    virtual\n    override\n    payable\n    ensure(deadline)\n    returns (uint[] memory amounts)\n{\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    require(amounts[0] <= msg.value, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    IWETH(WETH).deposit{value: amounts[0]}();\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n    _swap(amounts, path, to);\n    if (msg.value > amounts[0]) TransferHelper.safeTransferETH(msg.sender, msg.value - amounts[0]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapETHForExactTokens"),"\u7684\u5165\u53c2\u67094\u4e2a\uff0c\u51fa\u53c2\u67091\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapETHForExactTokens(\n    uint amountOut, // \u4ea4\u6613\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override payable ensure(deadline) returns (\n    uint[] memory amounts // \u4ea4\u6613\u671f\u671b\u6570\u91cf\u5217\u8868\n){\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapETHForExactTokens")," \u548c \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETH")," \u76f8\u6bd4\uff0c\u66f4\u6362\u4e86\u4ee3\u5e01\u4ea4\u6613\u7684\u987a\u5e8f\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline)\n{\n    // \u68c0\u67e5 path[0] \u662f\u5426\u4e3a WETH \u5730\u5740\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u83b7\u53d6 path \u5217\u8868\u4e0b\uff0c\u83b7\u5f97 amountOut \u6570\u91cf\u7684 path[path.length-1] \u4ee3\u5e01\uff0c\u5404\u4e2a\u4ee3\u5e01\u4ea4\u6613\u7684\u9884\u671f\u6570\u91cf\n    amounts = UniswapV2Library.getAmountsIn(factory, amountOut, path);\n    // \u5982\u679c ETH \u6570\u91cf\u5c0f\u4e8e amounts[0]\uff0c\u4ea4\u6613\u5931\u8d25\n    require(amounts[0] <= msg.value, 'UniswapV2Router: EXCESSIVE_INPUT_AMOUNT');\n    // \u5c06 WETH \u6362\u6210 ETH\n    IWETH(WETH).deposit{value: amounts[0]}();\n    // \u5c06 amounts[0] \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amounts[0]));\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swap(amounts, path, to);\n    // \u5982\u679c ETH \u6570\u91cf\u5927\u4e8e amounts[0]\uff0c\u8fd4\u8fd8\u591a\u4f59\u7684 ETH\n    if (msg.value > amounts[0]) TransferHelper.safeTransferETH(msg.sender, msg.value - amounts[0]);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u6b64\u51fd\u6570\u4e00\u822c\u7528\u4e8e\u8d2d\u4e70\u786e\u5b9a\u6570\u91cf\u4ee3\u5e01\uff0c\u652f\u4ed8\u4e0d\u786e\u5b9a\u6570\u91cf\u7684 ETH\u3002"))))))),(0,i.kt)("h2",{id:"\u4ea4\u6613\u652f\u6301\u4ee3\u4ed8gas\u4ee3\u5e01"},"\u4ea4\u6613\uff08\u652f\u6301\u4ee3\u4ed8GAS\u4ee3\u5e01\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5185\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5185\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"_swapSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _swapSupportingFeeOnTransferTokens(address[] memory path, address _to) internal virtual {\n    for (uint i; i < path.length - 1; i++) {\n        (address input, address output) = (path[i], path[i + 1]);\n        (address token0,) = UniswapV2Library.sortTokens(input, output);\n        IUniswapV2Pair pair = IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output));\n        uint amountInput;\n        uint amountOutput;\n        {\n            (uint reserve0, uint reserve1,) = pair.getReserves();\n            (uint reserveInput, uint reserveOutput) = input == token0 ? (reserve0, reserve1) : (reserve1, reserve0);\n            amountInput = IERC20(input).balanceOf(address(pair)).sub(reserveInput);\n            amountOutput = UniswapV2Library.getAmountOut(amountInput, reserveInput, reserveOutput);\n        }\n        (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOutput) : (amountOutput, uint(0));\n        address to = i < path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n        pair.swap(amount0Out, amount1Out, to, new bytes(0));\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapETHForExactTokens")," \u7684\u5165\u53c2\u67092\u4e2a\uff0c\u51fa\u53c2\u67090\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function _swapSupportingFeeOnTransferTokens(\n    address[] memory path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address _to // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n) internal virtual {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_swapSupportingFeeOnTransferTokens")," \u76f8\u6bd4\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"_swap")," \u4e3a\u4e86\u652f\u6301 ",(0,i.kt)("inlineCode",{parentName:"p"},"path")," \u4e2d\u6709\u4ea4\u6613\u540e\u53ef\u53d8\u6570\u91cf\u7684\u4ee3\u5e01\uff0c\u4e0d\u9700\u8981\u8f93\u5165 ",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\uff0c\u4f46\u9700\u8981\u989d\u5916\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n{\n    // \u5faa\u73af\u4ea4\u6613\u8def\u5f84\u5217\u8868\n    for (uint i; i < path.length - 1; i++) {\n        // \u4ece path \u4e2d\u53d6\u51fa input \u548c output\n        (address input, address output) = (path[i], path[i + 1]);\n        // \u4ece input \u548c output \u4e2d\u7b97\u51fa\u8c01\u662f token0\n        (address token0,) = UniswapV2Library.sortTokens(input, output);\n        // \u83b7\u5f97 input, output \u7684\u6d41\u52a8\u6c60\n        IUniswapV2Pair pair = IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output));\n        uint amountInput;\n        uint amountOutput;\n        {\n            // \u83b7\u53d6\u6d41\u52a8\u6c60\u5e93\u5b58 reserve0, reserve1\n            (uint reserve0, uint reserve1,) = pair.getReserves();\n            // \u5982\u679c input == token0\uff0c\u90a3\u4e48 (reserveInput,reserveOutput) \u5c31\u662f (reserve0, reserve1)\uff1b\u53cd\u4e4b\u5219\u76f8\u53cd\n            (uint reserveInput, uint reserveOutput) = input == token0 ? (reserve0, reserve1) : (reserve1, reserve0);\n            // amountInput \u7b49\u4e8e\u6d41\u52a8\u6c60\u4f59\u989d\u51cf\u53bb reserveInput\n            amountInput = IERC20(input).balanceOf(address(pair)).sub(reserveInput);\n            // \u83b7\u53d6 amountOutput\n            amountOutput = UniswapV2Library.getAmountOut(amountInput, reserveInput, reserveOutput);\n        }\n        // \u5982\u679c input == token0\uff0c\u90a3\u4e48 amount0Out \u5c31\u662f0\uff0camount1Out \u5c31\u662f amountOut\uff1b\u53cd\u4e4b\u5219\u76f8\u53cd\n        (uint amount0Out, uint amount1Out) = input == token0 ? (uint(0), amountOutput) : (amountOutput, uint(0));\n        // \u5982\u679c\u8fd9\u662f\u6700\u540e\u7684\u4e00\u7b14\u4ea4\u6613\uff0c\u90a3\u4e48 to \u5730\u5740\u5c31\u662f _to\uff0c\u5426\u5219 to \u5730\u5740\u662f\u4e0b\u4e00\u7b14\u4ea4\u6613\u7684\u6d41\u52a8\u6c60\u5730\u5740\n        address to = i < path.length - 2 ? UniswapV2Library.pairFor(factory, output, path[i + 2]) : _to;\n        // \u6267\u884c input \u548c output \u7684\u4ea4\u6613\n        pair.swap(amount0Out, amount1Out, to, new bytes(0));\n    }\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u53ef\u4ee5\u770b\u5230\uff0c\u56e0\u4e3a\u6ca1\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\uff0c\u9700\u8981\u4f7f\u7528\u6d41\u52a8\u6c60\u4f59\u989d\u51cf\u53bb\u5e93\u5b58\u6765\u8ba1\u7b97",(0,i.kt)("inlineCode",{parentName:"p"},"amountInput"),"\u3002")))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5916\u90e8\u51fd\u6570\uff08\u4ec5\u4f9b\u5408\u7ea6\u5916\u90e8\u8c03\u7528\uff09"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactTokensForTokensSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForTokensSupportingFeeOnTransferTokens(\n    uint amountIn,\n    uint amountOutMin,\n    address[] calldata path,\n    address to,\n    uint deadline\n) external virtual override ensure(deadline) {\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n    );\n    uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n    _swapSupportingFeeOnTransferTokens(path, to);\n    require(\n        IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) >= amountOutMin,\n        'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokensSupportingFeeOnTransferTokens"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67090\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForTokensSupportingFeeOnTransferTokens(\n    uint amountIn,// \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u6570\u91cf\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokensSupportingFeeOnTransferTokens")," \u76f8\u6bd4\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForTokens"),"\uff0c\u5c11\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\uff0c\u56e0\u4e3a\u4ea4\u6613\u540e\u53ef\u53d8\u6570\u91cf\u7684\u4ee3\u5e01\u4e0d\u80fd\u505a",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\u7684\u9884\u6d4b\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline) \n{\n    // \u5c06 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n    );\n    // \u8bb0\u5f55 to \u5730\u5740 path[path.length - 1] \u4ee3\u5e01\u7684\u4f59\u989d\n    uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swapSupportingFeeOnTransferTokens(path, to);\n    // \u5982\u679c to \u5730\u5740\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u4ea4\u6613\u5931\u8d25\n    require(\n        IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) >= amountOutMin,\n        'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u8be5\u51fd\u6570\u9002\u7528\u4e8e\u652f\u4ed8\u786e\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\uff0c\u83b7\u5f97\u4e0d\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\uff0c\u4e14\u5728 path \u8def\u5f84\u5217\u8868\u4e2d\u6709\u4ea4\u6613\u540e\u6570\u91cf\u53ef\u53d8\u7684\u4ee3\u5e01\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactETHForTokensSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactETHForTokensSupportingFeeOnTransferTokens(\n    uint amountOutMin,\n    address[] calldata path,\n    address to,\n    uint deadline\n)\n    external\n    virtual\n    override\n    payable\n    ensure(deadline)\n{\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    uint amountIn = msg.value;\n    IWETH(WETH).deposit{value: amountIn}();\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn));\n    uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n    _swapSupportingFeeOnTransferTokens(path, to);\n    require(\n        IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) >= amountOutMin,\n        'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokensSupportingFeeOnTransferTokens"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67090\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactETHForTokensSupportingFeeOnTransferTokens(\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override payable ensure(deadline)\n{\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokensSupportingFeeOnTransferTokens")," \u76f8\u6bd4\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactETHForTokens"),"\uff0c\u540c\u6837\u5c11\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\uff0c\u56e0\u4e3a\u4ea4\u6613\u540e\u53ef\u53d8\u6570\u91cf\u7684\u4ee3\u5e01\u4e0d\u80fd\u505a",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\u7684\u9884\u6d4b\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline) \n{\n    // \u68c0\u67e5 path[0] \u662f\u5426\u4e3a WETH\n    require(path[0] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u83b7\u53d6 amountIn\n    uint amountIn = msg.value;\n    // \u628a ETH \u6362\u6210 WETH\n    IWETH(WETH).deposit{value: amountIn}();\n    // \u5c06 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    assert(IWETH(WETH).transfer(UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn));\n    // \u8bb0\u5f55 to \u5730\u5740 path[path.length - 1] \u4ee3\u5e01\u7684\u4f59\u989d\n    uint balanceBefore = IERC20(path[path.length - 1]).balanceOf(to);\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swapSupportingFeeOnTransferTokens(path, to);\n    // \u5982\u679c to \u5730\u5740\u83b7\u5f97\u7684\u4ee3\u5e01\u6570\u91cf\u5c0f\u4e8e amountOutMin\uff0c\u4ea4\u6613\u5931\u8d25\n    require(\n        IERC20(path[path.length - 1]).balanceOf(to).sub(balanceBefore) >= amountOutMin,\n        'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT'\n    );\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u8be5\u51fd\u6570\u9002\u7528\u4e8e\u652f\u4ed8\u786e\u5b9a\u6570\u91cf\u7684 ETH\uff0c\u83b7\u5f97\u4e0d\u5b9a\u6570\u91cf\u7684\u4ee3\u5e01\uff0c\u4e14\u5728 path \u8def\u5f84\u5217\u8868\u4e2d\u6709\u4ea4\u6613\u540e\u6570\u91cf\u53ef\u53d8\u7684\u4ee3\u5e01\u3002")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"swapExactTokensForETHSupportingFeeOnTransferTokens"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee3\u7801\u901f\u89c8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForETHSupportingFeeOnTransferTokens(\n    uint amountIn,\n    uint amountOutMin,\n    address[] calldata path,\n    address to,\n    uint deadline\n)\n    external\n    virtual\n    override\n    ensure(deadline)\n{\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n    );\n    _swapSupportingFeeOnTransferTokens(path, address(this));\n    uint amountOut = IERC20(WETH).balanceOf(address(this));\n    require(amountOut >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    IWETH(WETH).withdraw(amountOut);\n    TransferHelper.safeTransferETH(to, amountOut);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53c2\u6570\u5206\u6790"),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETHSupportingFeeOnTransferTokens"),"\u7684\u5165\u53c2\u67095\u4e2a\uff0c\u51fa\u53c2\u67090\u4e2a\uff0c\u5bf9\u5e94\u7684\u89e3\u91ca\u5982\u4e0b\uff1a"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"function swapExactTokensForETHSupportingFeeOnTransferTokens(\n    uint amountIn,// \u4ea4\u6613\u652f\u4ed8\u4ee3\u5e01\u6570\u91cf\n    uint amountOutMin, // \u4ea4\u6613\u83b7\u5f97\u4ee3\u5e01\u6700\u5c0f\u503c\n    address[] calldata path, // \u4ea4\u6613\u8def\u5f84\u5217\u8868\n    address to, // \u4ea4\u6613\u83b7\u5f97\u7684 token \u53d1\u9001\u5230\u7684\u5730\u5740\n    uint deadline // \u8fc7\u671f\u65f6\u95f4\n) external virtual override ensure(deadline) {\n    ...\n}\n")),(0,i.kt)("p",{parentName:"li"},"  \u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETHSupportingFeeOnTransferTokens")," \u76f8\u6bd4\u51fd\u6570 ",(0,i.kt)("inlineCode",{parentName:"p"},"swapExactTokensForETH"),"\uff0c\u4e5f\u5c11\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\uff0c\u56e0\u4e3a\u4ea4\u6613\u540e\u53ef\u53d8\u6570\u91cf\u7684\u4ee3\u5e01\u4e0d\u80fd\u505a",(0,i.kt)("inlineCode",{parentName:"p"},"amounts"),"\u7684\u9884\u6d4b\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5b9e\u73b0\u5206\u6790"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"... \n// \u68c0\u67e5\u4ea4\u6613\u662f\u5426\u8fc7\u671f\nensure(deadline) \n{\n    // \u68c0\u67e5 path[path.length - 1] \u662f\u5426\u4e3a WETH\n    require(path[path.length - 1] == WETH, 'UniswapV2Router: INVALID_PATH');\n    // \u5c06 amountIn \u6570\u91cf\u7684 path[0] \u4ee3\u5e01\u4ece\u7528\u6237\u8d26\u6237\u4e2d\u8f6c\u79fb\u5230 path[0], path[1] \u7684\u6d41\u52a8\u6c60\n    TransferHelper.safeTransferFrom(\n        path[0], msg.sender, UniswapV2Library.pairFor(factory, path[0], path[1]), amountIn\n    );\n    // \u6309 path \u5217\u8868\u6267\u884c\u4ea4\u6613\u96c6\u5408\n    _swapSupportingFeeOnTransferTokens(path, address(this));\n    // \u83b7\u53d6 Router \u4e2d\u7684 WETH \u4f59\u989d\n    uint amountOut = IERC20(WETH).balanceOf(address(this));\n    // amountOut \u5927\u4e8e amountOutMin\uff0c\u5426\u5219\u4ea4\u6613\u5931\u8d25\n    require(amountOut >= amountOutMin, 'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');\n    // \u5c06 WETH \u6362\u6210 ETH\n    IWETH(WETH).withdraw(amountOut);\n    // \u5c06 ETH \u53d1\u9001\u7ed9 to \u5730\u5740\n    TransferHelper.safeTransferETH(to, amountOut);\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"li"},"  \u8be5\u51fd\u6570\u9002\u7528\u4e8e\u652f\u4ed8\u786e\u5b9a\u6570\u91cf\u7684 token\uff0c\u83b7\u5f97\u4e0d\u5b9a\u6570\u91cf\u7684 WETH\uff0c\u4e14\u5728 path \u8def\u5f84\u5217\u8868\u4e2d\u6709\u4ea4\u6613\u540e\u6570\u91cf\u53ef\u53d8\u7684\u4ee3\u5e01\u3002"))))))))}d.isMDXComponent=!0}}]);