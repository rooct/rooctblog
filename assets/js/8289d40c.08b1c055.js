"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3552],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(n),f=a,m=p["".concat(c,".").concat(f)]||p[f]||d[f]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3180:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return c},default:function(){return p},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return u}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={title:"Hiding Malicious Code with External Contract",version:"0.8.10",description:"An example of exploit where malicious code is hidden in an external contract in Solidity"},c=void 0,s={unversionedId:"Example/ExternalContract",id:"Example/ExternalContract",isDocsHomePage:!1,title:"Hiding Malicious Code with External Contract",description:"An example of exploit where malicious code is hidden in an external contract in Solidity",source:"@site/docs/Example/ExternalContract.md",sourceDirName:"Example",slug:"/Example/ExternalContract",permalink:"/rooctblog/docs/Example/ExternalContract",tags:[],version:"current",frontMatter:{title:"Hiding Malicious Code with External Contract",version:"0.8.10",description:"An example of exploit where malicious code is hidden in an external contract in Solidity"},sidebar:"tutorialSidebar",previous:{title:"Events",permalink:"/rooctblog/docs/Example/Events"},next:{title:"Fallback",permalink:"/rooctblog/docs/Example/Fallback"}},u=[{value:"Vulnerability",id:"vulnerability",children:[]},{value:"Preventative Techniques",id:"preventative-techniques",children:[]}],d={toc:u};function p(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"vulnerability"},"Vulnerability"),(0,o.kt)("p",null,"In Solidity any address can be casted into specific contract,\neven if the contract at the address is not the one being casted."),(0,o.kt)("p",null,"This can be exploited to hide malicious code. Let's see how."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.10;\n\n/*\nLet\'s say Alice can see the code of Foo and Bar but not Mal.\nIt is obvious to Alice that Foo.callBar() executes the code inside Bar.log().\nHowever Eve deploys Foo with the address of Mal, so that calling Foo.callBar()\nwill actually execute the code at Mal.\n*/\n\n/*\n1. Eve deploys Mal\n2. Eve deploys Foo with the address of Mal\n3. Alice calls Foo.callBar() after reading the code and judging that it is\n   safe to call.\n4. Although Alice expected Bar.log() to be execute, Mal.log() was executed.\n*/\n\ncontract Foo {\n    Bar bar;\n\n    constructor(address _bar) {\n        bar = Bar(_bar);\n    }\n\n    function callBar() public {\n        bar.log();\n    }\n}\n\ncontract Bar {\n    event Log(string message);\n\n    function log() public {\n        emit Log("Bar was called");\n    }\n}\n\n// This code is hidden in a separate file\ncontract Mal {\n    event Log(string message);\n\n    // function () external {\n    //     emit Log("Mal was called");\n    // }\n\n    // Actually we can execute the same exploit even if this function does\n    // not exist by using the fallback\n    function log() public {\n        emit Log("Mal was called");\n    }\n}\n\n')),(0,o.kt)("h3",{id:"preventative-techniques"},"Preventative Techniques"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Initialize a new contract inside the constructor"),(0,o.kt)("li",{parentName:"ul"},"Make the address of external contract ",(0,o.kt)("inlineCode",{parentName:"li"},"public")," so that the code of the\nexternal contract can be reviewed")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-solidity"},"Bar public bar;\n\nconstructor() public {\n    bar = new Bar();\n}\n")))}p.isMDXComponent=!0}}]);