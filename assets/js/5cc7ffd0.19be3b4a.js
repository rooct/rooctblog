"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[878],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return l}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},m=Object.keys(e);for(n=0;n<m.length;n++)r=m[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(n=0;n<m.length;n++)r=m[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var a=n.createContext({}),c=function(e){var t=n.useContext(a),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(a.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,m=e.originalType,a=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(r),l=o,y=p["".concat(a,".").concat(l)]||p[l]||d[l]||m;return r?n.createElement(y,i(i({ref:t},u),{},{components:r})):n.createElement(y,i({ref:t},u))}));function l(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var m=r.length,i=new Array(m);i[0]=p;var s={};for(var a in t)hasOwnProperty.call(t,a)&&(s[a]=t[a]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<m;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},4525:function(e,t,r){r.r(t),r.d(t,{contentTitle:function(){return a},default:function(){return p},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var n=r(7462),o=r(3366),m=(r(7294),r(3905)),i=["components"],s={title:"\u4f9b\u5e94\u94fe"},a=void 0,c={unversionedId:"dapps/Example/\u4f9b\u5e94\u94fe",id:"dapps/Example/\u4f9b\u5e94\u94fe",isDocsHomePage:!1,title:"\u4f9b\u5e94\u94fe",description:"\u57fa\u4e8eSolidity\u8bed\u8a00\u7684\uff0c\u9002\u7528\u4e8e\u4f9b\u5e94\u94fe\u6eaf\u6e90\u573a\u666f\u7684\u667a\u80fd\u5408\u7ea6\u793a\u4f8b",source:"@site/docs/dapps/Example/\u4f9b\u5e94\u94fe.md",sourceDirName:"dapps/Example",slug:"/dapps/Example/\u4f9b\u5e94\u94fe",permalink:"/rooctblog/docs/dapps/Example/\u4f9b\u5e94\u94fe",tags:[],version:"current",frontMatter:{title:"\u4f9b\u5e94\u94fe"},sidebar:"dapp",previous:{title:"\u4ee5\u592a\u867e\u519c\u5e84",permalink:"/rooctblog/docs/dapps/Example/\u4ee5\u592a\u867e\u519c\u5e84"},next:{title:"\u516c\u5f00\u62cd\u5356",permalink:"/rooctblog/docs/dapps/Example/\u516c\u5f00\u62cd\u5356"}},u=[],d={toc:u};function p(e){var t=e.components,r=(0,o.Z)(e,i);return(0,m.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,m.kt)("p",null,"\u57fa\u4e8eSolidity\u8bed\u8a00\u7684\uff0c\u9002\u7528\u4e8e\u4f9b\u5e94\u94fe\u6eaf\u6e90\u573a\u666f\u7684\u667a\u80fd\u5408\u7ea6\u793a\u4f8b"),(0,m.kt)("h1",{id:"\u573a\u666f\u63cf\u8ff0"},"\u573a\u666f\u63cf\u8ff0"),(0,m.kt)("p",null,"\u4f9b\u5e94\u94fe\u6eaf\u6e90\u5408\u7ea6\u6709\u4ee5\u4e0b\u51e0\u7c7b\u53c2\u4e0e\u65b9\uff1a"),(0,m.kt)("ul",null,(0,m.kt)("li",{parentName:"ul"},"\u5546\u54c1\u5382\u5546\uff1a\u4fdd\u5b58\u4e8e",(0,m.kt)("inlineCode",{parentName:"li"},"mapping(address => User) producerMap")),(0,m.kt)("li",{parentName:"ul"},"\u5404\u7ea7\u7ecf\u9500\u5546\uff1a\u4fdd\u5b58\u4e8e",(0,m.kt)("inlineCode",{parentName:"li"},"mapping(address => User) retailerMap")),(0,m.kt)("li",{parentName:"ul"},"\u6d88\u8d39\u8005\uff1a\u4fdd\u5b58\u4e8e",(0,m.kt)("inlineCode",{parentName:"li"},"mapping(address => User) customerMap"))),(0,m.kt)("p",null,"\u5404\u7c7b\u53c2\u4e0e\u65b9\u5747\u901a\u8fc7",(0,m.kt)("inlineCode",{parentName:"p"},"newUser"),"\u65b9\u6cd5\u8fdb\u884c\u4e0a\u94fe\u767b\u8bb0\u3002\u901a\u8fc7\u4f20\u9012\u4e0d\u540c\u7684Actor\u503c\u6765\u6307\u5b9a\u4e0d\u540c\u53c2\u4e0e\u65b9\u3002"),(0,m.kt)("p",null,"\u5382\u5546\u9996\u5148\u901a\u8fc7",(0,m.kt)("inlineCode",{parentName:"p"},"newProduct"),"\u65b9\u6cd5\u5c06\u51fa\u5382\u5546\u54c1\u767b\u8bb0\u5230\u533a\u5757\u94fe\uff0c\u968f\u540e\u5546\u54c1\u5206\u9500\u5230\u4e0b\u4e00\u7ea7\u7ecf\u9500\u5546\uff0c\u63a5\u4e0b\u6765\u7684\u73af\u8282\uff0c\u6bcf\u4e00\u6b21\u5546\u54c1\u7684\u5206\u9500\u5747\u5728\u63a5\u6536\u5546\u54c1\u7684\u7ecf\u9500\u5546\u5904\u8c03\u7528",(0,m.kt)("inlineCode",{parentName:"p"},"retailerInnerTransfer"),"\u65b9\u6cd5\u5c06\u5546\u54c1\u8fdb\u884c\u4e0a\u94fe\u767b\u8bb0\uff0c\u6700\u7ec8\u5546\u54c1\u5728\u96f6\u552e\u5546\u5904\u7531\u6d88\u8d39\u8005\u8d2d\u4e70\uff0c\u8c03\u7528",(0,m.kt)("inlineCode",{parentName:"p"},"fromRetailerToCustomer"),"\u65b9\u6cd5\u8fdb\u884c\u6700\u7ec8\u767b\u8bb0\uff0c\u5b8c\u6210\u6574\u4e2a\u51fa\u5382-\u591a\u7ea7\u5206\u9500-\u96f6\u552e\u7684\u6d41\u7a0b\u3002\u5546\u54c1\u4e00\u65e6\u7531\u5382\u5546\u767b\u8bb0\u4e0a\u94fe\uff0c\u4fbf\u53ef\u901a\u8fc7",(0,m.kt)("inlineCode",{parentName:"p"},"getCommodity"),"\u67e5\u8be2\u5230\u5546\u54c1\u5f53\u524d\u7684\u5206\u9500\u4fe1\u606f\uff0c\u53ea\u6709\u5904\u4e8e\u8be5\u5206\u9500\u8def\u5f84\u4e0a\u7684\u53c2\u4e0e\u65b9\u624d\u5141\u8bb8\u67e5\u8be2\u3002\u6b64\u5916\uff0c\u901a\u8fc7",(0,m.kt)("inlineCode",{parentName:"p"},"addWhiteList"),"\u53ef\u4ee5\u4e3a\u6307\u5b9a\u53c2\u4e0e\u65b9\u6dfb\u52a0\u9876\u7ea7\u67e5\u8be2\u6743\u9650\uff0c\u88ab\u6dfb\u52a0\u5230WhiteList\u7684\u53c2\u4e0e\u65b9\uff0c\u5373\u4f7f\u4e0d\u53c2\u4e0e\u5230\u67d0\u5546\u54c1\u7684\u5206\u9500\u8def\u5f84\u4e2d\uff0c\u4e5f\u53ef\u67e5\u8be2\u5230\u8be5\u5546\u54c1\u7684\u5206\u9500\u4fe1\u606f\u3002"),(0,m.kt)("pre",null,(0,m.kt)("code",{parentName:"pre"},'contract SupplyChain {\n    enum Actor{ Others, Producer, Retailer, Customer}\n    enum Commoditytype{ Wine, Jewelry, Shrimp, Others}\n    enum Phase{ Supplier, Producer, Dealer, Retailer, Customer}\n\n    struct User{\n        bytes32 ID;\n        bytes32 name;\n        Actor actor;\n    }\n\n    struct Commodity{\n        bytes32 commodityID;\n        bytes32 commodityName;\n        uint produceTime;\n        bytes32 producerName;\n        uint[] timestamps;\n        bytes32[] retailerNames;\n        uint sellTime;\n        bytes32 customerName;\n        bool isBinding;\n        address owner;\n    }\n\n    mapping(address => User) producerMap;\n    mapping(address => User) retailerMap;\n    mapping(address => User) customerMap;\n    mapping(bytes32 => Commodity) commodityMap;\n    mapping(address => bool) whiteList;\n    address owner;\n\n    function SupplyChain(){\n        owner = msg.sender;\n        whiteList[owner] = true;\n    }\n\n    function addWhiteList(address addr){\n        whiteList[addr] = true;\n    }\n\n    function newUser(bytes32 ID, bytes32 name,Actor actor) returns(bool, string){\n        User user;\n\n        if(actor == Actor.Producer){\n            user = producerMap[msg.sender];\n        }else if(actor == Actor.Retailer){\n            user = retailerMap[msg.sender];\n        }else if(actor == Actor.Customer){\n            user = customerMap[msg.sender];\n        }else{\n            return (false,"the actor is not belong");\n        }\n\n        if(user.ID != 0x0){\n            return (false, "this ID has been occupied!");\n        }\n        user.ID = ID;\n        user.name = name;\n        user.actor = actor;\n        return (true, "Success");\n    }\n\n    // this interface just for producer\n    function newProduct(bytes32 commodityID, bytes32 commodityName,\n    uint timestamp) returns(bool,bytes32){\n        Commodity commodity = commodityMap[commodityID];\n        if(commodity.commodityID != 0x0) {\n            return (false,"The commodityID already exist!");\n        }\n        User user = producerMap[msg.sender];\n        if(user.ID == 0x0) {\n            return (false,"The producer don\'t exist!");\n        }\n        commodity.commodityID = commodityID;\n        commodity.commodityName = commodityName;\n        commodity.produceTime = timestamp;\n        commodity.producerName = user.name;\n        return (true,"Success,produce a new product");\n    }\n\n\n    // this interface just for retailer\n    function retailerInnerTransfer(bytes32 commodityID,uint timestamp) returns(bool, string){\n        Commodity commodity = commodityMap[commodityID];\n        if(commodity.commodityID == 0x0) {\n            return (false,"The commodityID don\'t exist!");\n        }\n        User user = retailerMap[msg.sender];\n        if(user.ID == 0x0) {\n            return (false,"The retailer don\'t exist!");\n        }\n        commodity.timestamps.push(timestamp);\n        commodity.retailerNames.push( user.name );\n        return (true,"Success");\n    }\n\n    function fromRetailerToCustomer(bytes32 commodityID,uint timestamp) returns(bool, string){\n        Commodity commodity = commodityMap[commodityID];\n        if(commodity.commodityID == 0x0) {\n            return (false,"The commodityID don\'t exist!");\n        }\n        commodity.sellTime = timestamp;\n        return (true,"Success,Has been sold");\n    }\n\n    // just for Supervision organization\n    function getCommodityRecordsByWhiteList(bytes32 commodityID) returns(bool,string,\n    bytes32 producerName,uint produceTime, bytes32[] retailerNames,uint[] retailerTimes\n    , bytes32 customerName,uint sellTime){\n        if(!whiteList[msg.sender]){\n            return (false,"you has no access",producerName, produceTime, retailerNames, retailerTimes, customerName,commodity.sellTime);\n        }\n        Commodity commodity = commodityMap[commodityID];\n        if(commodity.commodityID == 0x0){\n            return (false,"The commodityID is not exist",producerName, produceTime, retailerNames, retailerTimes,customerName,commodity.sellTime);\n        }\n        return (true,"Success",commodity.producerName, commodity.produceTime, commodity.retailerNames, commodity.timestamps, commodity.customerName,commodity.sellTime);\n    }\n\n\n    function getCommodity(bytes32 commodityID,Actor actor)  returns(bool,string,\n    bytes32 producerName,uint produceTime,bytes32[] retailerNames,uint[] retailerTimes\n    , bytes32 customerName,uint sellTime){\n        Commodity commodity = commodityMap[commodityID];\n        if(commodity.commodityID == 0x0){\n            return (false,"The commodityID is not exist",producerName,produceTime,\n            retailerNames,retailerTimes,customerName,sellTime);\n        }\n        User user;\n        if(actor == Actor.Producer){\n            user = producerMap[msg.sender];\n        }else if(actor == Actor.Retailer){\n            user = retailerMap[msg.sender];\n        }else if(actor == Actor.Customer){\n            user = customerMap[msg.sender];\n        }else{\n            return (false,"the actor is not belong",producerName,produceTime,\n            retailerNames,retailerTimes,customerName,sellTime);\n        }\n        if(commodity.isBinding){\n            if(commodity.owner != msg.sender){\n                return (false,"warning,this commodity has been bound",producerName,produceTime,\n            retailerNames,retailerTimes,customerName,sellTime);\n            }else{\n                (false,"has already bind",commodity.producerName,commodity.retailerNames,commodity.customerName);\n            }\n        }\n        if(commodity.sellTime > 0 ) {\n            commodity.isBinding = true;\n            commodity.owner = msg.sender;\n            commodity.customerName = user.name;\n        }\n        return (true,"Success",commodity.producerName,commodity.produceTime,commodity.retailerNames,commodity.timestamps,commodity.customerName,commodity.sellTime);\n    }\n}\n')))}p.isMDXComponent=!0}}]);