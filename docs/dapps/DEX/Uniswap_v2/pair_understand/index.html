<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/rooctblog/blog/rss.xml" title="Develop Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rooctblog/blog/atom.xml" title="Develop Site Blog Atom Feed"><title data-react-helmet="true">Uniswap-v2 Pairåˆçº¦åˆ†æ | Develop Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://rooct.github.io/rooctblog/docs/dapps/DEX/Uniswap_v2/pair_understand"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Uniswap-v2 Pairåˆçº¦åˆ†æ | Develop Site"><meta data-react-helmet="true" name="description" content="Pair åˆçº¦æ˜¯ Uniswap-v2 çš„èµ„é‡‘æ± çš„åˆçº¦ï¼Œé€šè¿‡åˆ†æå®ƒå¯ä»¥æ·±å…¥äº†è§£ Uniswap-v2 èµ„é‡‘æ± çš„è¿è¡Œé€»è¾‘ã€‚"><meta data-react-helmet="true" property="og:description" content="Pair åˆçº¦æ˜¯ Uniswap-v2 çš„èµ„é‡‘æ± çš„åˆçº¦ï¼Œé€šè¿‡åˆ†æå®ƒå¯ä»¥æ·±å…¥äº†è§£ Uniswap-v2 èµ„é‡‘æ± çš„è¿è¡Œé€»è¾‘ã€‚"><link data-react-helmet="true" rel="shortcut icon" href="/rooctblog/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://rooct.github.io/rooctblog/docs/dapps/DEX/Uniswap_v2/pair_understand"><link data-react-helmet="true" rel="alternate" href="https://rooct.github.io/rooctblog/docs/dapps/DEX/Uniswap_v2/pair_understand" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://rooct.github.io/rooctblog/docs/dapps/DEX/Uniswap_v2/pair_understand" hreflang="x-default"><link rel="stylesheet" href="/rooctblog/assets/css/styles.63c342b0.css">
<link rel="preload" href="/rooctblog/assets/js/runtime~main.cf7fc36f.js" as="script">
<link rel="preload" href="/rooctblog/assets/js/main.998fc8e4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rooctblog/"><img src="/rooctblog/img/logo.svg" alt="Dev Site Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/rooctblog/img/logo.svg" alt="Dev Site Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Dev Site</b></a><a class="navbar__item navbar__link" href="/rooctblog/docs/intro">Solidity</a><a class="navbar__item navbar__link" href="/rooctblog/docs/evm">EVM</a><a class="navbar__item navbar__link navbar__link--active" href="/rooctblog/docs/dapp">Dapps</a><a class="navbar__item navbar__link" href="/rooctblog/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Dapps</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapp">smartcontract</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">DEX</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/README">å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Uniswap_v2</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/README">Uniswap_v2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/factory_understand">Uniswap-v2 Factoryåˆçº¦åˆ†æ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/official_deploy">ä½¿ç”¨å®˜æ–¹é¡¹ç›®éƒ¨ç½² Uniswap-v2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/pair_understand">Uniswap-v2 Pairåˆçº¦åˆ†æ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/project_history">Uniswap-v2 é¡¹ç›®å†å²</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/quick_deploy">å¿«é€Ÿéƒ¨ç½² Uniswap-v2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/quick_understand">å¿«é€Ÿäº†è§£ Uniswap-v2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/router_understand">Uniswap-v2 Routeråˆçº¦åˆ†æ</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/whitepaper">Uniswap-v2ç™½çš®ä¹¦</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Event</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Example</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">GunPool</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Loan</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">NFT</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Robot</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Solidity</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">StableCoin</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Uniswap-v2 Pairåˆçº¦åˆ†æ</h1></header><p>Pair åˆçº¦æ˜¯ Uniswap-v2 çš„èµ„é‡‘æ± çš„åˆçº¦ï¼Œé€šè¿‡åˆ†æå®ƒå¯ä»¥æ·±å…¥äº†è§£ Uniswap-v2 èµ„é‡‘æ± çš„è¿è¡Œé€»è¾‘ã€‚</p><p>æ¼”ç¤ºä»£ç ä»“åº“ï¼š<a href="https://github.com/33357/uniswap-v2-contract" target="_blank" rel="noopener noreferrer">https://github.com/33357/uniswap-v2-contract</a>ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="åˆçº¦åˆå§‹åŒ–"></a>åˆçº¦åˆå§‹åŒ–<a class="hash-link" href="#åˆçº¦åˆå§‹åŒ–" title="Direct link to heading">#</a></h2><ul><li><p>å…¬å…±å‡½æ•°ï¼ˆåˆçº¦å†…å¤–éƒ¨éƒ½å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>constructor</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ</p><p>  å‡½æ•° <code>constructor</code> çš„å…¥å‚æœ‰0ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªã€‚
åœ¨åˆçº¦åˆå§‹åŒ–æ—¶ï¼ŒPair åˆçº¦ä¼šå°† <code>msg.sender</code> è®°å½•ä¸º <code>factory</code> åœ°å€ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è®¾ç½® factory åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    factory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  Pair åˆçº¦åˆå§‹åŒ–æ—¶ï¼Œä¼šè®°å½• <code>factory</code> åœ°å€ã€‚</p></li></ul></li></ul></li><li><p>å¤–éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å¤–éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>initialize</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address _token0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> address _token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: FORBIDDEN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ</p><p>  å‡½æ•° <code>initialize</code> çš„å…¥å‚æœ‰2ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initialize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token0 åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token1 </span><span class="token comment" style="color:#999988;font-style:italic">// token1 åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  ç”±äº create2 å‡½æ•°æ— æ³•ä¼ å‚ï¼Œå› æ­¤éœ€è¦å†æ¬¡è°ƒç”¨ <code>initialize</code> å‡½æ•°æ¥è®°å½• <code>token0</code> å’Œ <code>token1</code> çš„åœ°å€ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ£€æŸ¥ msg.sender åœ°å€ç­‰äº factory åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> factory</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: FORBIDDEN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è®°å½• token0 å’Œ token1 åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  ç”±äº <code>initialize</code> æ˜¯åˆå§‹åŒ–å‡½æ•°ï¼Œå› æ­¤åªèƒ½ç”± factory è°ƒç”¨ï¼Œä¸”åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="èµ„é‡‘æ± çŠ¶æ€"></a>èµ„é‡‘æ± çŠ¶æ€<a class="hash-link" href="#èµ„é‡‘æ± çŠ¶æ€" title="Direct link to heading">#</a></h2><ul><li><p>å…¬å…±å‡½æ•°ï¼ˆåˆçº¦å†…å¤–éƒ¨éƒ½å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>getReserves</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> view </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint112 _reserve0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint112 _reserve1</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint32 _blockTimestampLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _reserve0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _reserve1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _blockTimestampLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ</p><p>  å‡½æ•° <code>getReserves</code> çš„å…¥å‚æœ‰0ä¸ªï¼Œå‡ºå‚æœ‰3ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> view </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token0 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token1 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 _blockTimestampLast </span><span class="token comment" style="color:#999988;font-style:italic">// ä¸Šæ¬¡æ›´æ–°åº“å­˜çš„æ—¶é—´</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>getReserves</code> è¿”å›äº† <code>_reserve0</code>ã€<code>_reserve1</code> å’Œ <code>_blockTimestampLast</code>ï¼Œé€šè¿‡è¿™äº›å˜é‡å¯ä»¥è®¡ç®—èµ„äº§çš„ä»·æ ¼ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è¿”å› reserve0ã€reserve1 å’Œ blockTimestampLast</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _reserve0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _reserve1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    _blockTimestampLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  æ–¹ä¾¿è·å–å½“å‰èµ„é‡‘æ± çŠ¶æ€ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="æ›´æ–°èµ„é‡‘æ± "></a>æ›´æ–°èµ„é‡‘æ± <a class="hash-link" href="#æ›´æ–°èµ„é‡‘æ± " title="Direct link to heading">#</a></h2><ul><li><p>å†…éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å†…éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>_update</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint balance0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint balance1</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint112 _reserve0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: OVERFLOW&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 blockTimestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 timeElapsed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestamp </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeElapsed </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        price0CumulativeLast </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UQ112x112</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uqdiv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        price1CumulativeLast </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UQ112x112</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uqdiv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reserve0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reserve1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    blockTimestampLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestamp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ</p><p>  å‡½æ•° <code>_update</code> çš„å…¥å‚æœ‰4ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token0 çš„ä½™é¢</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token1 çš„ä½™é¢</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token0 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve1 </span><span class="token comment" style="color:#999988;font-style:italic">// token1 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>_update</code> çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹èµ„é‡‘æ± çš„è®°å½•åº“å­˜å’Œå®é™…ä½™é¢è¿›è¡ŒåŒ¹é…ï¼Œä¿è¯åº“å­˜å’Œä½™é¢ç»Ÿä¸€ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ balance0 å’Œ blanace1 ä¸è¶…è¿‡ uint112 çš„ä¸Šé™</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: OVERFLOW&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// blockTimestamp åªå–æœ€å 32 ä½</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 blockTimestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint32</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">block</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timestamp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è®¡ç®—æ—¶é—´å·® timeElapsed</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 timeElapsed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestamp </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> blockTimestampLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ timeElapsed &gt; 0 &amp;&amp; _reserve0 != 0 &amp;&amp; _reserve1 != 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeElapsed </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹ _reserve1 / _reserve0 * timeElapsed çš„ç»“æœåœ¨ price0CumulativeLast ä¸Šç´¯åŠ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        price0CumulativeLast </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UQ112x112</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uqdiv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¯¹ _reserve0 / _reserve1 * timeElapsed çš„ç»“æœåœ¨ price1CumulativeLast ä¸Šç´¯åŠ </span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        price1CumulativeLast </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">UQ112x112</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uqdiv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> timeElapsed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// reserve0 = balance0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reserve0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// reserve1 = balance1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    reserve1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint112</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// blockTimestampLast = blockTimestamp</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    blockTimestampLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> blockTimestamp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è§¦å‘äº‹ä»¶ Sync</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  å‡½æ•° <code>_update</code> ä¸­å¯¹ <code>price0CumulativeLast</code> å’Œ <code>price1CumulativeLast</code> è¿›è¡Œäº†ä¸æ—¶é—´æˆåæ¯”çš„æ•°å€¼ç´¯åŠ ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªå˜é‡è®¡ç®—å‡ºç›¸å¯¹å¹³è¡¡çš„å¸‚åœºä»·æ ¼ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="æ‰‹ç»­è´¹"></a>æ‰‹ç»­è´¹<a class="hash-link" href="#æ‰‹ç»­è´¹" title="Direct link to heading">#</a></h2><ul><li><p>å†…éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å†…éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>_mintFee</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint112 _reserve0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">bool feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address feeTo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">IUniswapV2Factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">feeTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> feeTo </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            uint rootK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            uint rootKLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootK </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint numerator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootK</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint denominator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rootK</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> numerator </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> denominator</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeTo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ</p><p>  å‡½æ•° <code>_mintFee</code> çš„å…¥å‚æœ‰2ä¸ªï¼Œå‡ºå‚æœ‰1ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// token0 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint112 _reserve1 </span><span class="token comment" style="color:#999988;font-style:italic">// token1 çš„èµ„é‡‘æ± åº“å­˜æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool feeOn </span><span class="token comment" style="color:#999988;font-style:italic">// æ˜¯å¦å¼€å¯æ‰‹ç»­è´¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>_mintFee</code> å®ç°äº†æ·»åŠ å’Œç§»é™¤æµåŠ¨æ€§æ—¶ï¼Œå‘ <code>feeTo</code> åœ°å€å‘é€æ‰‹ç»­è´¹çš„é€»è¾‘ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–æ‰‹ç»­è´¹æ¥æ”¶åœ°å€ feeTo</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address feeTo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">IUniswapV2Factory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">factory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">feeTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ feeTo ä¸æ˜¯å…¨0åœ°å€ï¼Œé‚£ä¹ˆ feeOn = true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> feeTo </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å– kLast</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kLast</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ feeOn == true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ _kLast != 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// rootK = (_reserve0*_reserve1)**2</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            uint rootK </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// rootKLast = _kLast**2</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            uint rootKLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ rootK &gt; rootKLast</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootK </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œè®¡ç®—é€»è¾‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œå¸Œæœ›æœ‰çŸ¥é“çš„è¡¥å……ä¸€ä¸‹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint numerator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootK</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint denominator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rootK</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rootKLast</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                uint liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> numerator </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> denominator</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// å‘ feeTo åœ°å€å¢å‘æ•°é‡ä¸º liquidity çš„ LP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeTo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_kLast </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ _kLast != 0ï¼ŒkLast = 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  è™½ç„¶åœ¨è¿™é‡Œå®ç°äº†å‘ <code>feeTo</code> åœ°å€å‘é€æ‰‹ç»­è´¹ï¼Œä½†æ˜¯ç›´åˆ°ç°åœ¨ï¼ˆ2022å¹´3æœˆ2æ—¥ï¼‰ï¼Œ<code>feeTo</code> åœ°å€éƒ½æ˜¯å…¨0åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æ”¶å–ä»»ä½•æ‰‹ç»­è´¹ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="æä¾›æµåŠ¨æ€§"></a>æä¾›æµåŠ¨æ€§<a class="hash-link" href="#æä¾›æµåŠ¨æ€§" title="Direct link to heading">#</a></h2><ul><li><p>å¤–éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å¤–éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>burn</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _totalSupply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ
å‡½æ•° <code>mint</code> çš„å…¥å‚æœ‰1ä¸ªï¼Œå‡ºå‚æœ‰1ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address to </span><span class="token comment" style="color:#999988;font-style:italic">// LP æ¥æ”¶åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint liquidity </span><span class="token comment" style="color:#999988;font-style:italic">// LP æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>mint</code> çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æˆ·å­˜å…¥æµåŠ¨æ€§ä»£å¸ï¼Œæå– LPã€‚æµåŠ¨æ€§ä»£å¸åœ¨è°ƒç”¨ <code>mint</code> ä¹‹å‰å°±å·²ç»å­˜å…¥äº†èµ„é‡‘æ± ï¼Œå› æ­¤éœ€è¦è®¡ç®—å­˜å…¥ä»£å¸æ•°é‡ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–è®°å½•åº“å­˜ _reserve0ï¼Œ_reserve1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–ä»£å¸ä½™é¢ balance0ï¼Œbalance1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–ç”¨æˆ·è´¨æŠ¼ä½™é¢ amount0ï¼Œamount1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å‘é€æ‰‹ç»­è´¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _totalSupply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ _totalSupply == 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// LP ä»£å¸æ•°é‡ liquidity = (amount0 * amount1)**2 - MINIMUM_LIQUIDITY</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å‘å…¨0åœ°å€å‘é€æ•°é‡ä¸º MINIMUM_LIQUIDITY çš„ LP ä»£å¸</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">MINIMUM_LIQUIDITY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// LP ä»£å¸æ•°é‡ liquidity = min(_totalSupply * amount0 / _reserve0, _totalSupply * amount1 / _reserve1)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_totalSupply</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ liquidity &gt; 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">liquidity </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY_MINTED&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å‘ to åœ°å€å‘é€æ•°é‡ä¸º liquidity</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°åº“å­˜</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ feeOn == trueï¼Œæ›´æ–° kLast</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è§¦å‘äº‹ä»¶ Mint</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Mint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  ä¸ºäº†é¿å…åˆ›å»ºæµåŠ¨æ€§çš„æ•°å€¼å¤ªå°å¼•å‘è®¡ç®—é”™è¯¯ï¼Œåˆ›å»ºæµåŠ¨æ€§éœ€è¦å¤§äº <code>MINIMUM_LIQUIDITY</code>ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="ç§»é™¤æµåŠ¨æ€§"></a>ç§»é™¤æµåŠ¨æ€§<a class="hash-link" href="#ç§»é™¤æµåŠ¨æ€§" title="Direct link to heading">#</a></h2><ul><li><p>å¤–éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å¤–éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>burn</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint amount0</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balanceOf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _totalSupply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> amount1 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ
å‡½æ•° <code>burn</code> çš„å…¥å‚æœ‰1ä¸ªï¼Œå‡ºå‚æœ‰2ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address to </span><span class="token comment" style="color:#999988;font-style:italic">// èµ„äº§æ¥æ”¶åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token function" style="color:#d73a49">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—çš„ token0 æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1 </span><span class="token comment" style="color:#999988;font-style:italic">// è·å¾—çš„ token1 æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>burn</code> çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æˆ·é”€æ¯ LPï¼Œä»èµ„é‡‘æ± æå–æµåŠ¨æ€§ä»£å¸ã€‚åŒæ ·åœ¨è°ƒç”¨ <code>burn</code> ä¹‹å‰ï¼ŒLP å·²ç»å‘é€ç»™èµ„é‡‘æ± ï¼Œèµ„é‡‘æ± ä¸­ LP ä½™é¢å°±æ˜¯éœ€è¦é”€æ¯çš„ LP æ•°é‡ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–è®°å½•åº“å­˜ _reserve0ï¼Œ_reserve1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å– _token0ï¼Œ_token1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–ä»£å¸ä½™é¢ balance0ï¼Œbalance1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å– liquidity</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint liquidity </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balanceOf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å‘é€æ‰‹ç»­è´¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool feeOn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_mintFee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint _totalSupply </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// amount0 = liquidity * balance0 / _totalSupply</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// amount1 = liquidity * balance1 / _totalSupply</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> _totalSupply</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ amount0 &gt; 0 &amp;&amp; amount1 &gt; 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> amount1 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY_BURNED&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é”€æ¯ liquidity æ•°é‡çš„ LPä»£å¸</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> liquidity</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å°† amount0 æ•°é‡çš„ _token0 å‘é€åˆ° to åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å°† amount1 æ•°é‡çš„ _token1 å‘é€åˆ° to åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// é‡æ–°è·å– balance0 å’Œ balance1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°åº“å­˜</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ feeOn == trueï¼Œæ›´æ–° kLast</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">feeOn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> kLast </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è§¦å‘äº‹ä»¶ Burn</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Burn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  å¦‚æœæœ‰äººå‘èµ„é‡‘æ± å‘é€ LPï¼Œé‚£ä¹ˆå®é™…ä¸Šå¹¶æ²¡æœ‰é”€æ¯è¯¥ LPï¼Œè€Œæ˜¯é€ç»™äº†ä¸‹ä¸€ä¸ªé”€æ¯ LP çš„äººã€‚å› ä¸ºè™½ç„¶æ²¡äººèƒ½æå–å‡ºæ¥ï¼Œä½†ä»»ä½•äººéƒ½å¯ä»¥é”€æ¯è¯¥ LP å¹¶è·å¾—ç›¸åº”çš„æµåŠ¨æ€§ä»£å¸ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="äº¤æ˜“"></a>äº¤æ˜“<a class="hash-link" href="#äº¤æ˜“" title="Direct link to heading">#</a></h2><ul><li><p>å¤–éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å¤–éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>swap</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">swap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">uint amount0Out</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> uint amount1Out</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> address to</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> bytes calldata data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> to </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INVALID_TO&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">IUniswapV2Callee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uniswapV2Call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0In </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount0Out </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1In </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0In </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> amount1In </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_INPUT_AMOUNT&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint balance0Adjusted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0In</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint balance1Adjusted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1In</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0Adjusted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1Adjusted</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: K&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Swap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0In</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1In</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ
å‡½æ•° <code>swap</code> çš„å…¥å‚æœ‰4ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">swap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// é¢„æœŸè·å¾—çš„ token0 æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// é¢„æœŸè·å¾—çš„ token1 æ•°é‡</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// èµ„äº§æ¥æ”¶åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes calldata data </span><span class="token comment" style="color:#999988;font-style:italic">// é—ªç”µè´·è°ƒç”¨æ•°æ®</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>swap</code> çš„ä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œä»£å¸äº¤æ¢ï¼Œå¹¶æ”¯æŒäº†é—ªç”µè´·çš„åŠŸèƒ½ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ amount0Out &gt; 0 || amount1Out &gt; 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_OUTPUT_AMOUNT&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è·å–è®°å½•åº“å­˜ _reserve0ï¼Œ_reserve1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint112 _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uint112 _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getReserves</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ amount0Out &lt; _reserve0 &amp;&amp; amount1Out &lt; _reserve1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_LIQUIDITY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint balance1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ to åœ°å€ä¸æ˜¯ token0 åœ°å€å’Œ token1 åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> _token0 </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> to </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> _token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INVALID_TO&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ amount0Out &gt; 0ï¼Œå‘ to åœ°å€å‘é€æ•°é‡ä¸º amount0Out çš„ _token0 ä»£å¸</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ amount1Out &gt; 0ï¼Œå‘ to åœ°å€å‘é€æ•°é‡ä¸º amount1Out çš„ _token1 ä»£å¸</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1Out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ data.length &gt; 0ï¼Œæ‰§è¡Œé—ªç”µè´·</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">IUniswapV2Callee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">uniswapV2Call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è·å– _token0 ä½™é¢ balance0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        balance0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// è·å– _token1 ä½™é¢ balance1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        balance1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ balance0 &gt; _reserve0 - amount0Outï¼Œéœ€è¦æ”¯ä»˜çš„ token0 æ•°é‡ amount0In = balance0 - (_reserve0 - amount0Out)ï¼Œå¦åˆ™ä¸º0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount0In </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> _reserve0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount0Out </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> balance0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å¦‚æœ balance1 &gt; _reserve1 - amount1Outï¼Œéœ€è¦æ”¯ä»˜çš„ token1 æ•°é‡ amount1In = balance1 - (_reserve1 - amount1Out)ï¼Œå¦åˆ™ä¸º0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint amount1In </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> _reserve1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount1Out </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> balance1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦ amount0In &gt; 0 || amount1In &gt; 0</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0In </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> amount1In </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: INSUFFICIENT_INPUT_AMOUNT&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// éœ€è¦äº¤æ˜“ä¹‹åçš„ K å€¼ä¸èƒ½å˜å°</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint balance0Adjusted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount0In</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        uint balance1Adjusted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount1In</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0Adjusted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance1Adjusted</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;UniswapV2: K&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°åº“å­˜</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balance0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// è§¦å‘ Swap äº‹ä»¶</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:#d73a49">Swap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0In</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1In</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount0Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount1Out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  æ¯”è¾ƒå·§å¦™çš„ä¸€ç‚¹æ˜¯ï¼Œ<code>swap</code> æ²¡æœ‰åœ¨äº¤æ˜“ä¹‹å‰è¿›è¡Œæ•°é‡è®¡ç®—ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨äº¤æ˜“å®Œæˆä¹‹åè¿›è¡Œæ£€æŸ¥ã€‚è¿™å‡å°‘äº†åŒºå—é“¾ä¸Šçš„è®¡ç®—é‡ï¼Œå¹¶å¾ˆå¥½åœ°æ”¯æŒäº†é—ªç”µè´·åŠŸèƒ½ã€‚</p></li></ul></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="å†å¹³è¡¡"></a>å†å¹³è¡¡<a class="hash-link" href="#å†å¹³è¡¡" title="Direct link to heading">#</a></h2><ul><li><p>å¤–éƒ¨å‡½æ•°ï¼ˆä»…åˆçº¦å¤–éƒ¨å¯ä»¥è°ƒç”¨ï¼‰</p><ul><li><p>skim</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">skim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ
å‡½æ•° <code>skim</code> çš„å…¥å‚æœ‰1ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªï¼Œå¯¹åº”çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">skim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address to </span><span class="token comment" style="color:#999988;font-style:italic">// èµ„äº§æ¥æ”¶åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>  å‡½æ•° <code>skim</code> å¯ä»¥è®©è°ƒç”¨è€…è·å¾—å¤šäºåº“å­˜çš„ä»£å¸ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _token1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å°†å¤šäºåº“å­˜ reserve0 çš„ä»£å¸ _token0 å‘é€åˆ° to åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// å°†å¤šäºåº“å­˜ reserve1 çš„ä»£å¸ _token1 å‘é€åˆ° to åœ°å€</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_safeTransfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> to</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°è·å–å¤šäºåº“å­˜çš„ä»£å¸ã€‚</p></li></ul></li><li><p>skim</p><ul><li><p>ä»£ç é€Ÿè§ˆ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> external lock </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>å‚æ•°åˆ†æ
å‡½æ•° <code>sync</code> çš„å…¥å‚æœ‰0ä¸ªï¼Œå‡ºå‚æœ‰0ä¸ªã€‚
å‡½æ•° <code>sync</code> ç”¨äºå¼ºåˆ¶åŒ¹é…åº“å­˜å’Œä»£å¸ä½™é¢ã€‚</p></li><li><p>å®ç°åˆ†æ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ›´æ–°åº“å­˜</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">IERC20</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">address</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reserve1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>æ€»ç»“</p><p>  ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å¼ºåˆ¶æ›´æ–°åº“å­˜ã€‚</p></li></ul></li></ul></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/official_deploy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ä½¿ç”¨å®˜æ–¹é¡¹ç›®éƒ¨ç½² Uniswap-v2</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rooctblog/docs/dapps/DEX/Uniswap_v2/project_history"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Uniswap-v2 é¡¹ç›®å†å² Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#åˆçº¦åˆå§‹åŒ–" class="table-of-contents__link">åˆçº¦åˆå§‹åŒ–</a></li><li><a href="#èµ„é‡‘æ± çŠ¶æ€" class="table-of-contents__link">èµ„é‡‘æ± çŠ¶æ€</a></li><li><a href="#æ›´æ–°èµ„é‡‘æ± " class="table-of-contents__link">æ›´æ–°èµ„é‡‘æ± </a></li><li><a href="#æ‰‹ç»­è´¹" class="table-of-contents__link">æ‰‹ç»­è´¹</a></li><li><a href="#æä¾›æµåŠ¨æ€§" class="table-of-contents__link">æä¾›æµåŠ¨æ€§</a></li><li><a href="#ç§»é™¤æµåŠ¨æ€§" class="table-of-contents__link">ç§»é™¤æµåŠ¨æ€§</a></li><li><a href="#äº¤æ˜“" class="table-of-contents__link">äº¤æ˜“</a></li><li><a href="#å†å¹³è¡¡" class="table-of-contents__link">å†å¹³è¡¡</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Solidity</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/rooctblog/docs/solidity/example/Helloworld">HelloWorld</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/rooctblog/">Stack Overflow</a></li></ul></div><div class="col footer__col"><div class="footer__title">Feature</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/rooctblog/">Feature</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/rooctblog/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/rooctblog/">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 dev site, Inc. Built with dev.</div></div></div></footer></div>
<script src="/rooctblog/assets/js/runtime~main.cf7fc36f.js"></script>
<script src="/rooctblog/assets/js/main.998fc8e4.js"></script>
</body>
</html>